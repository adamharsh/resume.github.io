(function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/comments/comment_dom",["external/react","modules/clean/referrer_cleansing_redirect"],function(t,n){var i,r,a;return i="…",r=function(i,r,o){var c,s,l,d,u,h,m,p,_,f,g,v,y,I,E,A,R,T;for(null==r&&(r=!0),null==o&&(o=null),s=t.DOM,m=/@\[(?:\s*(?:dbid:)?[^:\[\]]+):(?:[^\[]+)\]/i,h=/@\[(\s*(?:dbid:)?[^:\[\]]+):([^\[]+)\]/i,T="(?:[-a-zA-Z0-9@:%_+~#=]+[.])+[a-z]{2,6}(?:[:./?#][-a-zA-Z0-9@%_+~&=]+)*(?=[^a-zA-Z0-9_]|$)",A="http://"+T+"|https://"+T+"|www."+T+"|"+T,R=new RegExp(A,"i"),u=/\n/,v=[m,u],r&&v.push(R),y=RegExp("("+(function(){var e,t,n;for(n=[],e=0,t=v.length;e<t;e++)f=v[e],n.push(f.source);return n})().join("|")+")","gi"),_=[],g=i.split(y),l=0,d=g.length;l<d;l++)if(c=g[l])if(c.match(m))I=c.match(h),p=I[2].trim(),_.push(s.span({className:"comment-mention"},p));else if(e.call(v,R)>=0&&c.match(R)){E=c,E.indexOf("http://")<0&&E.indexOf("https://")<0&&(E="http://"+E);try{E=n.get_redirect_uri(E),_.push(s.a({href:E,target:"_blank",rel:"noopener noreferrer"},c))}catch(e){e,_.push(c)}}else c.match(u)?_.push(s.br({})):_.push(c);return a(_,o)},a=function(e,t){var n,r,a,o,c,s,l,d,u;if(null==t&&(t=null),!t)return e;if(n=0,u=[],t<=0)return e.length>0?i:e;for(r=0,o=e.length;r<o;r++)if(d=e[r],"object"==typeof d){if(null!=(null!=(c=d.props)?c.children:void 0)&&(n+=null!=(s=d.props)&&null!=(l=s.children)?l.length:void 0),u.push(d),n>=t)return u.push(i),u}else{if(n+d.length>=t)return a=t-n,u.push(d.substring(0,a)),u.push(i),u;n+=d.length,u.push(d)}return e},{convertRawCommentTextToReactDom:r}})}).call(this),function(){var e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e},t={}.hasOwnProperty;define("modules/clean/deprecated/dbmodal_loading",["modules/clean/dbmodal","modules/clean/deprecated/uirequest"],function(t,n){return(function(t){function i(e){i.__super__.constructor.call(this,e)}return e(i,t),i.prototype.on_show=function(){return this.fetch()},i.prototype.fetch=function(){return new n(this.$modal_window,this.options.endpoint_url,{data:this.options.parameters||{},subject_user:this.options.subject_user,html_in_error_msg:this.options.html_in_error_msg,error:(function(e){return function(t,n,i){return e.hide()}})(this)})},i.prototype.on_confirm_button_click=null,i.prototype.on_cancel_button_click=null,i})(t.DBModal)})}.call(this),define("modules/clean/fileops",["require","exports","tslib","jquery","modules/clean/ajax","modules/core/i18n","modules/core/notify","modules/core/uri"],function(e,t,n,i,r,a,o,c){"use strict";function s(e,t){var n=i.Deferred(),c=a.ungettext("Deleted %(file_count)s item.","Deleted %(file_count)s items.",t.length).format({file_count:t.length});return o.success(c),r.WebRequest({url:"/cmd/delete",data:{files:t},subject_user:e,success:function(e){n.resolve(e)},error:function(e){o.error(a._("Failed to perform the delete. Please try again later.")),n.reject(e)}}),n.promise()}function l(e,t,i){return void 0===i&&(i={}),i=n.__assign((r={},r._subject_uid=String(t),r),i),new c({path:"/history"+e,query:i});var r}Object.defineProperty(t,"__esModule",{value:!0}),t.do_nonbrowse_delete=s,t.build_revisions_uri=l}),function(){define("modules/clean/page_role_observer",["modules/core/exception"],function(e){var assert;return assert=e.assert,new((function(){function e(){this._listeners=[]}return e.prototype.addListener=function(e){return assert("function"==typeof e,"PageRoleState.addListener expects a function, got: "+typeof e),this._listeners.push(e)},e.prototype.removeListener=function(e){var t;return assert("function"==typeof e,"PageRoleState.removeListener expects a function, got: "+typeof e),this._listeners=function(){var n,i,r,a;for(r=this._listeners,a=[],n=0,i=r.length;n<i;n++)t=r[n],t!==e&&a.push(t);return a}.call(this)},e.prototype.removeAllListeners=function(){return this._listeners=[]},e.prototype.emit=function(e){var t,n,i,r,a;for(r=this._listeners.slice(),a=[],n=0,i=r.length;n<i;n++)t=r[n],a.push(t(e));return a},e})())})}.call(this),define("modules/clean/recent_activity/actions/error_actions",["require","exports","external/underscore","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/recent_activity_dispatcher","modules/core/exception","modules/core/i18n","modules/core/notify"],function(e,t,n,i,r,a,o,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=(function(){function e(e){var t=this;this._flushQueues=function(){t._rafId=null;var e=t._recentActivityQueue;t._recentActivityQueue=[],e.length&&t._dispatcher.dispatch({type:i.RAW_RECENT_ACTIVITY_PARSE_ERROR,errors:e});var n=t._relatedActivityQueue;t._relatedActivityQueue=[],n.length&&t._dispatcher.dispatch({type:i.RAW_RELATED_ACTIVITY_PARSE_ERROR,errors:n})},this._notify=n.throttle(function(){var e=o._("Sorry, we were unable to show some recent items. The team has been notified");c.error(e)},500,{trailing:!1}),this._dispatcher=e,this._recentActivityQueue=[],this._relatedActivityQueue=[],this._rafId=null}return e.prototype.recentActivityParseError=function(e,t){a.reportException({err:t}),this._notify(),this._enqueueError(this._recentActivityQueue,e,t)},e.prototype.relatedActivityParseError=function(e,t){a.reportException({err:t}),this._notify(),this._enqueueError(this._relatedActivityQueue,e,t)},e.prototype._enqueueError=function(e,t,n){e.push({activityKey:t,error:n}),this._rafId||(this._rafId=window.requestAnimationFrame(this._flushQueues))},e})();t.ErrorActions=s,t.errorActions=new s(r.recentActivityDispatcher)}),define("modules/clean/recent_activity/actions/recent_activity_action_permissions",["require","exports","modules/clean/recent_activity/models/utils"],function(e,t,n){"use strict";function i(e,t){return n.isShareLinkRecentItem(e)?r(!!t.canOpen):{open:!!t.canOpen,delete:!t.isReadOnly,download:!0,comment:!t.isDir,versions:!t.isDir,archive:!1,share:!1}}function r(e){return{archive:!1,comment:!1,delete:!1,download:!1,open:e,share:!1,versions:!1}}function a(e,t,i){if(e.federatedRecentItem)return{archive:e.federatedRecentItem.isArchiveable(),comment:!1,delete:!1,download:!1,open:!1,share:e.federatedRecentItem.isShareable(),versions:!1};var a=e.attachmentIds.length>1,c=t[0],s=i.length,l=!a||1===s;if(n.isShareLinkRecentItem(e))return r(!!(l&&c&&c.canOpen));var d=o(t,i),u=s>0,h=!c||!c.isDir;return{archive:!1,comment:l&&h,delete:u&&d.allSelectedItemsAreNotReadOnly||a&&d.allItemsAreNotReadOnly||!a&&c&&!c.isReadOnly,download:l,open:!!(l&&c&&c.canOpen),share:!!(l||u&&d.allSelectedItemsAreInRootCollections||d.allItemsAreInRootCollection),versions:l&&h}}function o(e,t){for(var n={allItemsAreInRootCollection:!0,allItemsAreNotReadOnly:!0,allSelectedItemsAreInRootCollections:!0,allSelectedItemsAreNotReadOnly:!0},i=0,r=e;i<r.length;i++){var a=r[i];a.inRootCollection||(n.allItemsAreInRootCollection=!1),a.isReadOnly&&(n.allItemsAreNotReadOnly=!1),t.indexOf(a.id)>=0&&(a.inRootCollection||(n.allSelectedItemsAreInRootCollections=!1),a.isReadOnly&&(n.allSelectedItemsAreNotReadOnly=!1))}return n}Object.defineProperty(t,"__esModule",{value:!0}),t.getDocAttachmentViewPermissions=i,t.getRecentActivityItemViewPermissions=a}),define("modules/clean/recent_activity/actions/recent_activity_actions",["require","exports","external/underscore","modules/clean/dbmodal","modules/clean/deprecated/dbmodal_loading","modules/clean/downloads","modules/clean/fileops","modules/clean/react/modal","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/recent_activity_client","modules/clean/recent_activity/recent_activity_dispatcher","modules/clean/recent_activity/recent_activity_logger","modules/clean/recent_activity/recent_activity_logger_utils","modules/clean/recent_activity/store_utils","modules/clean/recent_activity/stores/attachment_store","modules/clean/recent_activity/stores/recent_activity_store","modules/clean/sharing/async_share_modal_util","modules/clean/viewer","modules/core/browser","modules/core/exception","modules/core/i18n","modules/core/notify","modules/core/uri","modules/clean/recent_activity/store_utils","modules/clean/recent_activity/store_utils"],function(e,t,n,i,r,a,o,c,s,l,d,u,h,m,p,_,f,g,v,y,I,E,A,R,T){"use strict";function w(e,t,n,i){e.homeLogEventFunction(t,e.cellView,n,e.totalCount,i)}function S(e){return n.compact(n.pluck(e,"fqPath"))}function C(e){var t=_.recentActivityStore.cursorForUser(e);return t&&m.loadRecentItems(e,{cursor:t}),!!t}function N(e,t,n){m.ensureAttachments(e,[t],function(t){var i=t[0],r=i.fqPath||"",a=g.get_viewer().get_user_by_id(e);if(f.asyncShowShareModal(a,{fqPath:r,isFolder:i.previewInfo.is_dir,origin:"RECENTS"}),n){var o=S(t);h.logShareFile(e,r,n.totalCount,n.cellView),w(n,u.ActionTypes.SHARE,o,o.indexOf(r))}})}function L(e,t,n){m.ensureAttachments(e,t,function(t){var a=t.map(function(e){return{ns_id:e.nsId,ns_path:e.nsPath}});l.createCollectionSharedLink(e,a).then(function(t){if(t.shareableItemCount<a.length){var n=a.length-t.shareableItemCount;E.error(I.ungettext("%(missing)s file can’t be shared.","%(missing)s files can’t be shared.",n).format({missing:n}))}var o=new A({path:"/sm/get_link_modal_content/"+t.tkey}).toString();i.DBModalStack.push(new r({element_id:"share-link-modal",endpoint_url:o,subject_user:e,parameters:{origin:"recents"}}))}),n&&h.logShareCollection(e,S(t),n.totalCount,n.cellView)})}function b(e){v.redirect(e)}function O(t,i,r,a){void 0===a&&(a=n.noop),e(["modules/clean/unity/features"],function(e){y.assert(!!e,"Unity is not supported by this browser"),m.ensureAttachments(t,[i],function(i){var o=i[0],c=o.nsId,s=o.nsPath,l=i[0].fqPath||"";if(e.open_file(c,s,t,n.noop,function(e){E.error("We were unable to open this file"),y.reportException({err:Error(e),tags:["recents"],severity:y.SEVERITY.NONCRITICAL})}),r){var d=S(i);h.logUnityOpenFile(t,l,r.totalCount,r.cellView),w(r,u.ActionTypes.OPEN,d,d.indexOf(l))}a()})})}function P(e,t,i){var r,a,l=function(){return m.ensureAttachments(e,t,function(r){var a=S(r);if(i){var c=i.totalCount,l=i.cellView;h.logDeleteFiles(e,a,c,l),w(i,u.ActionTypes.DELETE,a,void 0)}var m=n.uniqueId("DELETE_FILES");d.recentActivityDispatcher.dispatch({type:s.DELETE_FILES_PENDING,attachmentIds:t,transactionId:m});var p=function(){return d.recentActivityDispatcher.dispatch({type:s.DELETE_FILES_COMMIT,transactionId:m})},_=function(){return d.recentActivityDispatcher.dispatch({type:s.DELETE_FILES_ROLLBACK,transactionId:m})};o.do_nonbrowse_delete(e,a).then(p,_)})};if(1===t.length){a=I._("Delete file?");var _=p.attachmentStore.getById(t[0]);r=_&&_.isLoaded?I._("Do you want to delete <b>%(file_name)s</b>?").format({file_name:n.escape(_.displayName||"")}):I._("Do you want to delete this file?")}else a=I._("Delete files?"),r=I._("Do you want to delete <b>%(num)s files</b>?").format({num:n.escape(String(t.length))});c.SimpleModal.show({title_text:a,body_html:r,confirm_text:I._("Delete"),confirm_callback:l,cancel_text:I._("Cancel"),autoclose:!0})}function D(e,t){d.recentActivityDispatcher.dispatch({type:s.RECEIVE_RAW_RELATED_ACTIVITIES_BY_KEY,rawRelatedActivitiesByKey:e,userId:t})}function x(e,t){d.recentActivityDispatcher.dispatch({type:s.SELECT_ATTACHMENTS,recentItemId:e,attachmentIds:t})}function k(e,t){d.recentActivityDispatcher.dispatch({type:s.DESELECT_ATTACHMENTS,recentItemId:e,attachmentIds:t})}function V(e,t,n){m.ensureAttachments(e,t,function(t){if(n){var i=S(t);h.logDownloadFile(e,i,n.totalCount,n.cellView),w(n,u.ActionTypes.DOWNLOAD,i)}for(var r=0,o=t;r<o.length;r++){var c=o[r];if(c.isDir&&c.fqPath&&null!=c.previewInfo&&null!=c.previewInfo.block_hash)a.get_zip({fq_paths:[c.fqPath],subject_uid:e,block_hash:c.previewInfo.block_hash,parent_path:c.fqPath});else{var s=null!=c.previewInfo?c.previewInfo.direct_blockserver_link:void 0;s&&a.get_blockserver_link({url:s})}}})}function F(e,t,n){m.ensureAttachments(e,[t],function(t){var i=t[0].fqPath||"",r=o.build_revisions_uri(i,e);if(n){var a=S(t);h.logOpenVersions(e,i,n.totalCount,n.cellView),w(n,u.ActionTypes.VERSIONS,a,a.indexOf(i))}v.redirect(r.toString())})}Object.defineProperty(t,"__esModule",{value:!0}),t.getFqPaths=S,t.loadNextPage=C,t.loadAttachmentsForRecentActivities=R.loadAttachmentsForRecentActivities,t.shareFile=N,t.shareCollection=L,t.browseFile=b,t.openFile=O,t.promptAndDeleteAttachments=P,t.loadAttachments=T.loadAttachments,t.updateRecentActivities=T.updateRecentActivities,t.updateRelatedActivities=D,t.selectAttachments=x,t.deselectAttachments=k,t.downloadFiles=V,t.openVersions=F}),define("modules/clean/recent_activity/models/attachment",["require","exports"],function(e,t){"use strict";function n(e){var t=e.preview_jsinfo||null,n=null,i=null;if(t&&(t.thumbnail_url_tmpl&&(n=t.thumbnail_url_tmpl),t.thumbnail_dimensions)){var r=t.thumbnail_dimensions,a=r[0];i={height:r[1],width:a}}var o=e.comment||{},c=o.commenter_dict||{};return{id:e.activity_key,isLoaded:!0,viewingUserId:e.viewing_user.id,displayName:e.name||null,entityUri:e.entity_uri||null,previewInfo:e.preview_jsinfo||null,fqPath:e.fq_path||null,nsPath:e.ns_path||null,nsId:e.ns_id||null,thumbnailUrl:n||null,thumbnailDimensions:i||null,canOpen:!1,inRootCollection:!1,isReadOnly:!!e.is_read_only,isDir:!!e.is_dir,commentRawText:o.raw_comment_text||null,commenterId:c.id||null,commenterDisplayName:c.display_name||null,commenterPhotoUrl:c.photo_circle_url||null}}function i(e){return(e.related_activity_keys||[]).map(function(t){return{id:t,viewingUserId:e.viewing_user.id,displayName:null,isLoaded:!1,canOpen:!1,inRootCollection:!1,isReadOnly:!1,isDir:!1,entityUri:null,previewInfo:null,fqPath:null,nsPath:null,nsId:null,thumbnailUrl:null,thumbnailDimensions:null,commentRawText:null,commenterId:null,commenterDisplayName:null,commenterPhotoUrl:null}})}Object.defineProperty(t,"__esModule",{value:!0}),t.convertFileActivityToAttachmentItem=n,t.createPartialAttachmentsFromRecentActivity=i}),define("modules/clean/recent_activity/models/recent_item",["require","exports","external/underscore","modules/clean/recent_activity/actions/error_actions","modules/clean/recent_activity/models/utils"],function(e,t,n,i,r){"use strict";function a(e){try{var t=e.skeleton_data;return{id:e.activity_key,type:e.recent_event_type||null,icon:t&&t.icon||null,when:e.when_milli||null,viewingUserId:e.viewing_user.id,displayName:t&&t.display_name||null,accountDisplayName:t&&t.account_display_name||null,contextDisplayName:t&&t.context_display_name||null,uniqueFilterTypes:t?n.unique(n.values(t.filter_types_by_key)):[],attachmentIds:e.related_activity_keys||[],paths:r.getPathsByFqPath(t&&t.context_display_path||"",e.viewing_user.id,!0),order:c(e.activity_key),idType:e.id_type,resourceId:e.resource_id}}catch(t){return n.defer(function(){return i.errorActions.recentActivityParseError(e.activity_key,t)}),null}}Object.defineProperty(t,"__esModule",{value:!0});var o=0,c=n.memoize(function(){return o+=1});t.convertRecentActivityToRecentItem=a}),define("modules/clean/recent_activity/models/utils",["require","exports","external/underscore","modules/clean/browse_interface","modules/clean/recent_activity/recent_activity_constants","modules/clean/viewer"],function(e,t,n,i,r,a){"use strict";function o(e){var t=n.values(e.filter_types_by_key);return s(t.length,n.unique(t))}function c(e){return s(e.attachmentIds.length,e.uniqueFilterTypes)}function s(e,t){return!!(e>1&&t.every(function(e){return g.indexOf(e)>=0}))}function l(e){return n.pluck(e,"id")}function d(e){return e in v}function u(e){return null!==e.type&&d(e.type)}function h(e,t,r){void 0===r&&(r=!1);var o=a.get_viewer().get_user_by_id(t);"/"===e&&(e="");var c=[],s=e.split("/");for(r||s.pop();s.length;){var l=n.last(s),d=s.join("/");1===s.length&&""===l&&(l=a.get_root_name(o),d="");var u=i.browse_uri_for_fq_path(o,d).toString();c.push({name:l||"",url:u}),s.pop()}return c.reverse()}function m(e,t){return t.when-e.when||e.order-t.order||t.type-e.type}Object.defineProperty(t,"__esModule",{value:!0});var p=r.RECENT_EVENT_FILTER_TYPE.PHOTOS,_=r.RECENT_EVENT_FILTER_TYPE.VIDEOS,f=r.RECENT_EVENT_FILTER_TYPE.VISUAL_NOTES,g=[p,_,f];t.shouldShowThumbnailsForSkeletonData=o,t.shouldShowThumbnailsForRecentItem=c,t.extractAttachmentIds=l;var v=(y={},y[r.RECENT_EVENT_TYPES.FILE_SHARED_ADD]=!0,y[r.RECENT_EVENT_TYPES.FILE_SHARED_VIEW]=!0,y);t.isShareLinkEventType=d,t.isShareLinkRecentItem=u,t.getPathsByFqPath=h,t.compareRecentItems=m;var y}),define("modules/clean/recent_activity/react/attachment_file_icon_view",["require","exports","tslib","external/classnames","external/react","external/underscore","modules/clean/em_string","modules/clean/react/sprite","modules/clean/recent_activity/react/selectable_view"],function(e,t,n,i,r,a,o,c,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onClick=function(e){e.preventDefault(),t.props.handleClick(t.props.id)},t.onContextMenu=function(e){e.preventDefault(),t.props.handleContextMenu(t.props.id)},t}return n.__extends(t,e),t.prototype.renderFilename=function(){var e=this.props.file.displayName.split("."),t="."+e.pop(),n=o.em_snippet(e.join("."),10);return r.createElement("span",{className:"attachment-item__filename"},n,r.createElement("wbr",null),r.createElement("span",{className:"nowrap"},t))},t.prototype.renderIcon=function(){return r.createElement(c,{alt:"",group:"web",name:this.props.file.icon,className:"attachment-item__icon"})},t.prototype.render=function(){var e,t,n=this.renderIcon(),a=this.renderFilename(),o=this.props,c=o.overlayText,l=o.isSelected,d=o.file;return c&&(t=r.createElement("span",{className:"attachment-item__overlay"},c)),this.props.showCheckmark&&(e=r.createElement(s.SelectableView,{id:this.props.id,handleToggleSelect:this.props.handleToggleSelect,isSelected:l})),r.createElement("div",{className:i({"attachment-item":!0,"attachment-item--file-thumb":!0,"attachment-item--show-more":!!c,"attachment-item--selected":l})},r.createElement("a",{href:d.entityUri,title:d.displayName,className:"attachment-item__anchor",onClick:this.onClick,onContextMenu:this.onContextMenu},n,a,t,e))},t})(r.Component);l.defaultProps={handleClick:a.noop,handleContextMenu:a.noop},t.AttachmentFileIconView=l}),define("modules/clean/recent_activity/react/attachment_grid",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=(function(){function e(e,t){this._gridWidth=e,this._gutterWidth=t}return e.create=function(t,n){return new e(t,n)},e.prototype.generate=function(e,t){void 0===t&&(t=1/0);for(var n=[],i=0;n.length<t&&i<e.length;){var r=this.buildRow(e.slice(i));i+=r.length,n.push(r)}return n},e.prototype.buildRow=function(e){for(var t=[],n=this._gridWidth+this._gutterWidth,i=0,r=e;i<r.length;i++){var a=r[i];if(n=n-a.width-this._gutterWidth,!(n>=0||0===t.length))break;t.push(a)}return t},e})();t.AttachmentGrid=n}),define("modules/clean/recent_activity/react/attachment_image_expanded_view",["require","exports","tslib","external/react","modules/clean/accessibility/utils","modules/clean/recent_activity/react/attachment_image_view"],function(e,t,n,i,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleCornerClick=function(e){e.preventDefault();var n=t.props.handleCornerClick;n&&n(t.props.id)},t}return n.__extends(t,e),t.prototype.render=function(){var e=this.props.image;return i.createElement("div",{className:"attachment-item attachment-item--expanded",style:{width:e.width,height:e.height}},i.createElement("div",{className:"attachment-item--expanded__image"},i.createElement(a.AttachmentImageView,n.__assign({},this.props))),i.createElement("a",n.__assign({},r.accessibleTriggerProps(this.handleCornerClick),{className:"attachment-item--expanded__corner"}),"-"))},t})(i.Component);t.AttachmentImageExpandedView=o}),define("modules/clean/recent_activity/react/attachment_image_stack_view",["require","exports","tslib","external/react","modules/clean/recent_activity/react/attachment_image_view"],function(e,t,n,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleCornerClick=function(e){e.preventDefault();var n=t.props.handleCornerClick;n&&n(t.props.id)},t}return n.__extends(t,e),t.prototype.render=function(){var e=this.props.image,t=e.width,a=e.height,o=t-4,c=a-4,s=n.__assign({},e,{width:o,height:c});return i.createElement("div",{className:"attachment-item attachment-item--stacked",style:{width:t,height:a}},i.createElement("div",{className:"attachment-item--stacked__front"},i.createElement(r.AttachmentImageView,n.__assign({},this.props,{image:s}))),i.createElement("div",{className:"attachment-item--stacked__back"},i.createElement(r.AttachmentImageView,{image:s})),i.createElement("a",{className:"attachment-item--stacked__corner",onClick:this.handleCornerClick},"+%(count)s".format({count:this.props.stackLength-1})))},t})(i.Component);t.AttachmentImageStackView=a}),define("modules/clean/recent_activity/react/attachment_image_view",["require","exports","tslib","external/classnames","external/react","modules/clean/recent_activity/react/selectable_view"],function(e,t,n,i,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={isLoading:!0},t.onClick=function(e){e.preventDefault(),t.props.handleClick(t.props.id)},t.onContextMenu=function(e){e.preventDefault(),t.props.handleContextMenu(t.props.id)},t.onLoad=function(){t.setState({isLoading:!1})},t.onError=function(){t.props.handleLoadError(t.props.id),t.setState({isLoading:!1})},t}return n.__extends(t,e),t.prototype.render=function(){var e,t,n=this.props,o=n.overlayText,c=n.showCheckmark,s=n.isSelected,l=n.badgeType,d=n.image;return o&&(t=r.createElement("span",{className:"attachment-item__overlay"},o)),c&&(e=r.createElement(a.SelectableView,{id:this.props.id,handleToggleSelect:this.props.handleToggleSelect,isSelected:s})),r.createElement("div",{className:i((u={"attachment-item":!0,"attachment-item--show-more":!!o,"attachment-item--is-loading":this.state.isLoading,"attachment-item--selected":s},u["attachment-item--badge-"+l]=!!l,u))},r.createElement("a",{href:d.entityUri,onClick:this.onClick,onContextMenu:this.onContextMenu,title:d.displayName,className:"attachment-item__anchor",style:{width:d.width,height:d.height},tabIndex:0},r.createElement("img",{alt:d.displayName,className:"attachment-item__thumbnail",src:d.thumbnailUrl,onLoad:this.onLoad,onError:this.onError}),t),e);var u},t})(r.PureComponent);o.defaultProps={handleClick:function(){},handleContextMenu:function(){},handleLoadError:function(){},handleToggleSelect:function(){},showCheckmark:!1,isSelected:!1},t.AttachmentImageView=o}),define("modules/clean/recent_activity/react/attachment_list_layout",["require","exports","external/underscore","modules/clean/photos/thumbnail_url_util","modules/clean/recent_activity/react/attachment_file_icon_view","modules/clean/recent_activity/react/attachment_grid","modules/clean/recent_activity/react/attachment_image_view","modules/core/browser","modules/core/exception"],function(e,t,n,i,r,a,o,c,s){"use strict";function l(e,t){var n,r,a,o=c.is_high_density_display();switch(t){case"aggregated-scaled":a=o?200:100,n=o?200:100,r=d;break;case"aggregated-cropped":a=o?200:100,n=o?200:100,r=u;break;case"aggregated-wide-cropped":a=o?718:359,n=o?200:100,r=u;break;default:return s.assert(!1,"invalid ThumbnailVariant: "+t),""}return i.thumbnailUrlForSize(e,a,n,r)}Object.defineProperty(t,"__esModule",{value:!0});var d=i.ThumbnailSizeMode.FIT_ONE,u=i.ThumbnailSizeMode.EXACT_NO_BACKGROUND,h=(function(){function e(e,t,n){this._gridWidth=e,this._columnWidth=t,this._gutterWidth=n,this._grid=a.AttachmentGrid.create(e,n)}return e.create=function(t,n,i){return new e(t,n,i)},e.prototype.generate=function(e,t,n){var i=this.cellMetadata(e,n);return this._grid.generate(i,t)},e.prototype.cellMetadata=function(e,t){var i=this,r=n.object(t,t);return e.map(function(e){return r[e.id]||e.isLoaded&&!e.thumbnailUrl?i.buildFileIconViewMetadata(e):e.isLoaded?i.buildImageViewMetadata(e):i.buildLoadingImageViewMetadata(e)})},e.prototype.buildFileIconViewMetadata=function(e){return{id:e.id,scaledThumbnailUrl:null,view:r.AttachmentFileIconView,width:92,height:100,attachment:e}},e.prototype.buildLoadingImageViewMetadata=function(e){return{id:e.id,scaledThumbnailUrl:null,view:null,width:100,height:100,attachment:e}},e.prototype.buildImageViewMetadata=function(e){var t=e.thumbnailUrl,n=this.calculateThumbnailDimensions(e.thumbnailDimensions),i=n.width,r=n.height,a=n.variant;return t.startsWith("data:")||(t=l(t,a)),{id:e.id,view:o.AttachmentImageView,scaledThumbnailUrl:t,width:i+6,height:r+6,attachment:e}},e.prototype.calculateThumbnailDimensions=function(e){var t,n,i;if(e){i="aggregated-scaled";var r=e.width/e.height;t=100,n=Math.floor(r*t),n>this._columnWidth-6&&(i="aggregated-wide-cropped",n=this._columnWidth-6)}return(!e||n<75)&&(i="aggregated-cropped",n=100,t=100),{width:n,height:t,variant:i}},e})();t.AttachmentListLayout=h}),define("modules/clean/recent_activity/react/attachment_list_view",["require","exports","tslib","external/react","external/underscore","jquery","modules/clean/components/loading_indicator","modules/clean/recent_activity/actions/recent_activity_actions","modules/clean/recent_activity/react/attachment_file_icon_view","modules/clean/recent_activity/react/attachment_image_expanded_view","modules/clean/recent_activity/react/attachment_image_stack_view","modules/clean/recent_activity/react/attachment_image_view","modules/clean/recent_activity/react/attachment_list_layout","modules/clean/recent_activity/recent_activity_constants","modules/clean/react_logger","modules/core/exception","modules/core/i18n"],function(e,t,n,i,r,a,o,c,s,l,d,u,h,m,p,_,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var g=(function(e){function t(t){var i=e.call(this,"AttachmentListView",t)||this;return i.setAttachmentListRef=function(e){return i.attachmentsList=e},i.state={rows:i.isAllSelected(i.props)?1/0:1,errored:[],containerWidth:null,expandedAttachments:{}},i.previewAttachment=function(e){var t=i.props.attachments,n={totalCount:t.length,cellView:i};i.props.renderingInfo.version.previewAttachment(e,t,n)},i.expandStack=function(e){for(var t=i.dedupeMetadata(),a=r.find(t,function(t){return t.attachment.id===e}),o=n.__assign({},i.state.expandedAttachments),c=i.props.attachments.indexOf(a.attachment),s=a.stackLength,l=c;l<c+s;l++)o[i.props.attachments[l].id]=e;i.setState({expandedAttachments:o})},i.collapseStack=function(e){for(var t=i.state.expandedAttachments[e],a=i.dedupeMetadata(),o=r.find(a,function(e){return e.attachment.id===t}),c=n.__assign({},i.state.expandedAttachments),s=i.props.attachments.indexOf(o.attachment),l=o.stackLength,d=s;d<s+l;d++)delete c[i.props.attachments[d].id];i.setState({expandedAttachments:c})},i.handleImageToggleSelect=function(e,t){var n=r.findWhere(i.props.attachments,{id:e});i.props.handleToggleSelect(n,t)},i.handleImageLoadError=function(e){var t=i.state.errored.slice();t.push(e),i.setState({errored:t})},i.revealNextGroup=function(){i.setState({rows:i.state.rows+m.SHOW_MORE_THUMBNAIL_ROW_INCREMENT})},i}return n.__extends(t,e),t.prototype.isAllSelected=function(e){return r.size(e.selectedAttachmentIds)===e.attachments.length},t.prototype.componentDidMount=function(){this.updateLayoutController(),this.state.rows>1&&this.loadRemainingAttachments(),e.prototype.componentDidMount.call(this)},t.prototype.componentWillReceiveProps=function(e){this.isAllSelected(e)&&this.setState({rows:1/0})},t.prototype.componentDidUpdate=function(e){this.updateLayoutController(),this.state.rows>1&&this.loadRemainingAttachments()},t.prototype.updateLayoutController=function(){var e=a(this.attachmentsList),t=e.innerWidth();if(t!==this.state.containerWidth){var n=Math.abs(parseFloat(e.css("margin-left")))||0,i=Math.floor(t/2)-n;this.layoutController=h.AttachmentListLayout.create(t,i,n),this.setState({containerWidth:t})}},t.prototype.loadRemainingAttachments=function(){var e=this.props.attachments[0].viewingUserId,t=this.props.attachments.filter(function(e){return!e.isLoaded}).map(function(e){return e.id});t.length&&c.loadAttachments(e,t)},t.prototype.renderFileIconView=function(e,t,n){var r=e.attachment;return i.createElement(s.AttachmentFileIconView,{key:"attachment-"+e.id,id:e.id,file:{icon:r.previewInfo.icon,displayName:r.displayName||"",entityUri:r.entityUri||""},overlayText:t,handleClick:n,showCheckmark:this.props.attachments.length>1&&!t,handleToggleSelect:this.handleImageToggleSelect,isSelected:this.props.selectedAttachmentIds.indexOf(r.id)>=0})},t.prototype.renderStackedImageView=function(e,t,r){var a=this.propsForImageView(e,r);return i.createElement(d.AttachmentImageStackView,n.__assign({},a,{key:"attachment-stacked-"+e.id,handleClick:this.expandStack,handleCornerClick:this.expandStack,stackLength:t}))},t.prototype.renderExpandedImageView=function(e,t,r){var a=this.propsForImageView(e,r);return i.createElement(l.AttachmentImageExpandedView,n.__assign({},a,{showCheckmark:this.props.attachments.length>1,handleCornerClick:this.collapseStack}))},t.prototype.renderImageView=function(e,t,r){var a=this.propsForImageView(e,r);return i.createElement(u.AttachmentImageView,n.__assign({},a,{key:"attachment-expanded-"+e.id,overlayText:t,showCheckmark:this.props.attachments.length>1&&!t}))},t.prototype.propsForImageView=function(e,t){var n=e.attachment,i=n.previewInfo,r="video"===(i&&i.preview_type);return{id:e.id,image:{thumbnailUrl:e.scaledThumbnailUrl,entityUri:n.entityUri||"",displayName:n.displayName||"",width:e.width,height:e.height},badgeType:r?"video":void 0,handleClick:t,handleLoadError:this.handleImageLoadError,handleToggleSelect:this.handleImageToggleSelect,isSelected:this.props.selectedAttachmentIds.indexOf(n.id)>=0}},t.prototype.dedupeMetadata=function(){var e,t=[],n={},i={},r={};if(this.props.duplicateIds)for(var a=0;a<this.props.attachments.length;a++){e=this.props.attachments[a];var o=this.props.duplicateIds[a];n.hasOwnProperty(o)||(n[o]=[],r[e.id]=e),n[o].push(e),i[e.id]=n[o]}for(var c=0,s=this.props.attachments;c<s.length;c++){e=s[c];var l=this.state.expandedAttachments.hasOwnProperty(e.id),d=i[e.id],u=d&&d.length,h=r.hasOwnProperty(e.id),m=u>1&&h;u>1&&!h&&!l||t.push({attachment:e,stackLength:u,isParentOfStack:h,isStacked:m,isExpanded:l})}return t},t.prototype.isLoading=function(){return this.state.rows>1&&this.props.attachments.some(function(e){return!e.isLoaded})},t.prototype.renderAttachmentItems=function(){if(!this.state.containerWidth)return[];for(var e=this.dedupeMetadata(),t=r.pluck(e,"attachment"),n=this.isLoading()?1:this.state.rows,a=this.layoutController.generate(t,n,this.state.errored),o=r.flatten(a),c=this.previewAttachment,l=o.length,d=t.length,h=d-l+1,m=!this.isLoading()&&l<d,p=[],g=0;g<o.length;g++){var v=void 0,y=void 0,I=o[g],E=g===o.length-1,A=e[g],R=A.isStacked,T=A.isParentOfStack,w=A.isExpanded,S=A.stackLength;E&&m&&(c=this.revealNextGroup,y=f._("+%(count)s").format({count:h}));var C="attachment-item-"+I.attachment.id;switch(I.view){case s.AttachmentFileIconView:v=this.renderFileIconView(I,y,c);break;case u.AttachmentImageView:var N=m&&E;S>1&&!N?T&&w?v=this.renderImageView(I,y,c):R&&!w?v=this.renderStackedImageView(I,S,c):w&&(v=this.renderExpandedImageView(I,y,c)):v=this.renderImageView(I,y,c);break;default:I.view&&_.assert(!1,I.view.name+" is not supported by AttachmentListView")}p.push(i.createElement("li",{key:C},v))}return p},t.prototype.renderLoadingView=function(){return i.createElement("div",{className:"attachment-loading"},i.createElement(o,{style:o.LoadingIndicatorStyle.BLUE_SPINNER,className:"recents-loading-indicator"}))},
t.prototype.render=function(){var e=null;return this.isLoading()&&(e=this.renderLoadingView()),i.createElement("div",{className:"recents-item__attachments"},i.createElement("ul",{ref:this.setAttachmentListRef,className:"attachment-list"},this.renderAttachmentItems()),e)},t})(p.ReactLogger);g.defaultProps={handleToggleSelect:function(){},selectedAttachmentIds:[]},t.AttachmentListView=g}),define("modules/clean/recent_activity/react/comment_attachment_view",["require","exports","tslib","external/react","modules/clean/avatar/avatar_with_default","modules/clean/avatar/initials_avatar","modules/clean/avatar/viewer_avatar","modules/clean/comments/comment_dom","modules/clean/viewer","modules/core/user_i18n"],function(e,t,n,i,r,a,o,c,s,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleClick=function(){t.props.handlePreview()},t}return n.__extends(t,e),t.prototype.renderCommentText=function(){var e=c.convertRawCommentTextToReactDom(this.props.attachment.commentRawText,!1);return i.createElement("div",{className:"comment-attachment-item__comment"},i.createElement("div",{className:"comment-bubble"},e))},t.prototype.renderAvatar=function(){var e=this.props.attachment,t={dimension:24,defaultAvatar:i.createElement(a,{key:"commenter-"+e.commenterId,dimension:24,shape:"CIRCLE",initials:l.getInitials(e.commenterDisplayName)}),photoUrl:null};""!==e.commenterPhotoUrl&&(t.photoUrl=e.commenterPhotoUrl);var c;return c=s.get_viewer().get_user_ids(!0).indexOf(e.commenterId)>=0?i.createElement(o,n.__assign({},t)):i.createElement(r,n.__assign({},t)),i.createElement("div",{className:"comment-attachment-item__avatar"},c)},t.prototype.render=function(){var e=this.renderAvatar(),t=this.renderCommentText();return i.createElement("div",{className:"comment-attachment-item",onClick:this.handleClick},e,t)},t})(i.PureComponent);d.defaultProps={handlePreview:function(){}},t.CommentAttachmentView=d}),define("modules/clean/recent_activity/react/doc_attachment_list_view",["require","exports","tslib","external/classnames","external/react","modules/clean/components/loading_indicator","modules/clean/react_logger","modules/clean/recent_activity/actions/recent_activity_actions","modules/clean/recent_activity/react/doc_attachment_view","modules/clean/recent_activity/recent_activity_constants","modules/core/exception","modules/core/i18n"],function(e,t,n,i,r,a,o,c,s,l,d,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var h=(function(e){function t(t){var n=e.call(this,"DocAttachmentListView",t)||this;return n.state={numberOfRows:l.MAX_INITIAL_DOC_ATTACHMENTS},n.revealNextGroup=function(e){e.preventDefault(),n.setState({numberOfRows:n.state.numberOfRows+l.SHOW_MORE_DOC_ATTACHMENT_INCREMENT})},n}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.state.numberOfRows>l.MAX_INITIAL_DOC_ATTACHMENTS&&this.loadRemainingAttachments(),e.prototype.componentDidMount.call(this)},t.prototype.componentDidUpdate=function(){this.state.numberOfRows>l.MAX_INITIAL_DOC_ATTACHMENTS&&this.loadRemainingAttachments()},t.prototype.componentWillReceiveProps=function(e){var t=this.props.attachments,n=this.state.numberOfRows,i=t.slice(0,n).filter(function(e){return e.isLoaded}).map(function(e){return e.id}),r=i.length,a=e.attachments.map(function(e){return e.id}).filter(function(e){return i.indexOf(e)>=0}).length;if(a<r){var o=n+a-r;d.assert(o>=0,"number of rows removed cannot be greater than the total number of rows"),this.setState({numberOfRows:n+a-r})}},t.prototype.loadRemainingAttachments=function(){var e=this.props.attachments;if(e.length){var t=e[0].viewingUserId,n=e.filter(function(e){return!e.isLoaded}).map(function(e){return e.id});n.length&&c.loadAttachments(t,n)}},t.prototype.shouldShowSubheading=function(){return!1},t.prototype.renderFileView=function(e){return r.createElement(s.DocAttachmentView,{key:"attachment-"+e.id,attachment:e,recentItem:this.props.recentItem,showSubHeading:this.shouldShowSubheading(),renderingInfo:this.props.renderingInfo})},t.prototype.renderLoadMoreView=function(e){var t=u._("Show %(num)s more").format({num:e});return r.createElement("button",{key:"attachment-load-more",className:"attachment-load-more button-as-link",onClick:this.revealNextGroup},t)},t.prototype.renderLoadingView=function(){return r.createElement("li",{key:"attachment-loading",className:"attachment-loading"},r.createElement(a,{style:a.LoadingIndicatorStyle.BLUE_SPINNER,className:"recents-loading-indicator"}))},t.prototype.renderFooter=function(e){var t=Math.min(e,l.SHOW_MORE_DOC_ATTACHMENT_INCREMENT);return r.createElement("li",{key:"attachment-footer",className:"doc-attachment-list__footer"},r.createElement("div",{className:"doc-attachment-list__footer--cell"},this.renderLoadMoreView(t)))},t.prototype.renderAttachmentItems=function(){var e=this,t=this.props.attachments,n=t.slice(0,this.state.numberOfRows),i=n.filter(function(e){return e.isLoaded}).map(function(t){return e.renderFileView(t)}),r=t.length-i.length;return n.filter(function(e){return!e.isLoaded}).length>0?i.push(this.renderLoadingView()):r>0&&i.push(this.renderFooter(r)),i},t.prototype.render=function(){var e=this.renderAttachmentItems(),t=this.props.attachments,n=null;0!==t.length&&(n=r.createElement("div",{className:"doc-attachment-list__spacer"}));var a={"recents-item__doc-attachments":!0,"recents-item__doc-attachments--collapsed":this.props.isCollapsed};return r.createElement("div",{className:i(a)},n,r.createElement("ul",{className:"doc-attachment-list"},e))},t})(o.ReactLogger);t.DocAttachmentListView=h}),define("modules/clean/recent_activity/react/doc_attachment_view",["require","exports","tslib","external/classnames","external/react","modules/clean/em_string","modules/clean/react/file_path_breadcrumb","modules/clean/recent_activity/actions/recent_activity_action_permissions","modules/clean/recent_activity/actions/recent_activity_actions","modules/clean/recent_activity/react/recent_activity_item_actions_view","modules/clean/recent_activity/react/recent_activity_item_header_view","modules/clean/recent_activity/models/utils","modules/clean/recent_activity/recent_activity_view_helper","modules/core/exception","modules/core/i18n"],function(e,t,n,i,r,a,o,c,s,l,d,u,h,m,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var _=(function(e){function t(t){var n=e.call(this,t)||this;return n.previewOrOpenFiles=function(e){n.getVersion().previewOrBrowseRecentItem(n.getRecentItem(),n.getAttachments(),{shouldFocusCommentInput:e},n.getLogData())},n.onBlur=function(e){n.setState({isFocused:!1})},n.onFocus=function(e){n.setState({isFocused:!0})},n.onMouseEnter=function(e){n.setState({isHovered:!0})},n.onMouseLeave=function(e){n.setState({isHovered:!1})},n.onPreview=function(e){e.preventDefault(),n.previewOrOpenFiles(!1)},n.handleArchive=function(){},n.handleComment=function(){n.previewOrOpenFiles(!0)},n.handleDelete=function(){n.getVersion().deleteRecentItem(n.getRecentItem(),n.getAttachments(),n.getLogData())},n.handleDeselectAll=function(){},n.handleDownload=function(){s.downloadFiles(n.getViewingUserId(),[n.getAttachmentId()],n.getLoggingInfo())},n.handleSelectAll=function(){},n.handleOpen=function(){m.assert(!!n.getAttachment().canOpen,"This item does not support opening"),s.openFile(n.getViewingUserId(),n.getAttachmentId(),n.getLoggingInfo())},n.handleShare=function(){n.getVersion().shareRecentItem(n.getRecentItem(),n.getAttachments(),n.getLogData())},n.handleVersions=function(){s.openVersions(n.getViewingUserId(),n.getAttachmentId(),n.getLoggingInfo())},n.onShowTooltip=function(){n.setState({tooltipShown:!0})},n.onHideTooltip=function(){n.setState({tooltipShown:!1})},n.state={tooltipShown:!1,isHovered:!1,isFocused:!1},n}return n.__extends(t,e),t.prototype.getVersion=function(){return this.props.renderingInfo.version},t.prototype.getRecentItem=function(){return this.props.recentItem},t.prototype.getAttachment=function(){return this.props.attachment},t.prototype.getAttachments=function(){return[this.props.attachment]},t.prototype.getAttachmentId=function(){return this.props.attachment.id},t.prototype.getViewingUserId=function(){return this.props.attachment.viewingUserId},t.prototype.getLogData=function(){return{totalCount:this.getRecentItem().attachmentIds.length,cellView:this}},t.prototype.getLoggingInfo=function(){return this.getVersion().getLoggingInfo(this.getLogData())},t.prototype.isSharedLink=function(){return u.isShareLinkRecentItem(this.getRecentItem())},t.prototype.getIcon=function(){var e=this.getAttachment().previewInfo;return e&&e.icon||"page_white_text"},t.prototype.getHeaderProps=function(){var e=this.getAttachment(),t={heading:e.displayName&&a.em_snippet(e.displayName,35)||"",icon:this.getIcon(),star:this.getVersion().renderStar(this.props.renderingInfo.role,this.getRecentItem())};return this.props.showSubHeading&&(t.subheading=this.renderSubheading()),e.thumbnailUrl&&(t.thumbnailUrl=e.thumbnailUrl),t},t.prototype.renderSubheading=function(){return this.getRecentItem().paths.length?r.createElement(o.FilePathBreadcrumb,{handlePathClick:this.props.handlePathClick,paths:this.getRecentItem().paths}):null},t.prototype.renderShareButton=function(){return r.createElement("a",{ref:"shareLink",className:"recents-item__share-link button-secondary",href:"#share",onClick:this.handleShare},p._("Share"))},t.prototype.renderActions=function(){return r.createElement(l.RecentActivityItemActionsView,{ref:"recentsItemActionsView",permissions:c.getDocAttachmentViewPermissions(this.getRecentItem(),this.getAttachment()),handler:this,tooltipHandler:this,selectCount:0,attachmentCount:1,disableActions:!1,type:this.getRecentItem().type,rowIsHovered:this.state.isHovered,renderingInfo:this.props.renderingInfo})},t.prototype.renderHeading=function(){return r.createElement(d.RecentActivityItemHeaderView,{ref:"recentsItemHeader",header:this.getHeaderProps(),tooltipShown:this.state.tooltipShown,handleClick:this.onPreview,recentActivityType:null},this.isSharedLink()?null:r.createElement("div",{className:"recents-item__sharing recents-item__action-button"},this.renderShareButton()),this.renderActions())},t.prototype.render=function(){return r.createElement("li",{className:i((e={},e["doc-attachment-item"]=!0,e["doc-attachment-item--focused-in"]=this.state.isFocused,e)),onClick:h.ensureUserIntentToClick(this.onPreview),onBlur:this.onBlur,onFocus:this.onFocus,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave},this.renderHeading());var e},t})(r.PureComponent);_.defaultProps={showSubheading:!1},t.DocAttachmentView=_}),define("modules/clean/recent_activity/react/pending_attachment_list_view",["require","exports","tslib","external/classnames","external/react","external/underscore"],function(e,t,n,i,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e=this.props.count,t=a.times(Math.min(e,4),function(){return r.createElement("li",{className:"attachment-item attachment-item--placeholder"})}),n={"attachment-list":!0,"attachment-list--is-pending":!0,"attachment-list--standalone":1===e};return r.createElement("div",{className:"recents-item__attachments"},r.createElement("ul",{className:i(n)},t))},t})(r.Component);t.PendingAttachmentListView=o}),define("modules/clean/recent_activity/react/recent_activity_container",["require","exports","tslib","jquery","external/underscore","external/react","modules/clean/react_logger","modules/clean/page_role_observer","modules/clean/web_timing_logger","modules/clean/recent_activity/actions/recent_activity_actions","modules/clean/recent_activity/react/recent_activity_view","modules/clean/recent_activity/recent_activity_constants","modules/clean/viewer"],function(e,t,n,i,r,a,o,c,s,l,d,u,h){"use strict";function m(e){var t=0,n=function(){var n=i(window).scrollTop()/(document.documentElement.scrollHeight-window.innerHeight);n>.8&&n>t&&e(),t=n};window.addEventListener("scroll",r.throttle(n,150,{trailing:!1}),!1)}function p(e){"function"==typeof e&&e()}Object.defineProperty(t,"__esModule",{value:!0});var _=(function(t){function i(e){var n=t.call(this,i.displayName,e)||this;return n.onShouldLoadMore=function(){var e=n.getCurrentUser();if(e&&!n.state.isPending&&n.getVersion().shouldLoadMore(e.id,n.state.filter)){var t=n.getRecentItems();t.length>n.state.items.length?n.setState({items:t}):l.loadNextPage(e.id)&&n.setState({isPending:!0})}},n.onUpdateFromStore=function(){var e=n.getRecentItems(),t=n.getVersion().isStoreReadyForUserId(n.getCurrentUserId(),n.hasRecentItems());n.setState({isPending:!t,items:e})},n.onRoleUpdate=function(e){if(e!==n.state.role){var t=n.getRecentItems(e);n.getVersion().loadPage(n.getUserId(e)),n.setState({role:e,items:t,filter:u.RECENT_EVENT_FILTER_TYPE.ALL,isPending:0===t.length,renderingInfo:n.createRenderingInfo(e,null)})}},n.removeStoreListeners=null,n.logTimeToInteractive=null,n._timer=0,n.state={items:[],role:n.props.initialRole,filter:u.RECENT_EVENT_FILTER_TYPE.ALL,isPending:!1,renderingInfo:n.createRenderingInfo(n.props.initialRole,!1)},n}return n.__extends(i,t),i.prototype.componentWillMount=function(){t.prototype.componentWillMount.call(this);var e=this.props.shouldThrottleRecents?r.throttle(this.onUpdateFromStore,1e3):this.onUpdateFromStore;this.removeStoreListeners=this.getVersion().getRemoveStoreListeners(e),this.getVersion().prefetchOnMount(this.getCurrentUserId());var n=this.getRecentItems();this.didReceiveRecentActivities()?this.setState({isPending:!1,items:n}):this.setState({isPending:0===n.length,items:n}),c.addListener(this.onRoleUpdate),this.logTimeToInteractive=this.getVersion().maybeInitLoggingAndGetTTILogger()},i.prototype.hasRecentItems=function(){return this.state.items.length>0},i.prototype.componentDidMount=function(){var n=this;m(r.throttle(this.onShouldLoadMore,2e3,{trailing:!1})),s.waitForTTI().then(function(){n.getVersion().possiblyRequireFileViewer(),e(["modules/clean/sharing/share_modal_util","modules/clean/sharing/wizard/wizard_modals","modules/clean/unity/features"],function(e,t,i,r){null!=r&&n.setState({renderingInfo:n.createRenderingInfo(null,!0)})})}),!this.hasRecentItems()&&this.didReceiveRecentActivities()&&(p(this.logTimeToInteractive),this.setState({isPending:!1})),t.prototype.componentDidMount.call(this)},i.prototype.clearLoadNewItemsTimer=function(){this._timer&&(clearInterval(this._timer),this._timer=null)},i.prototype.didReceiveRecentActivities=function(){return this.getVersion().didReceiveRecentActivities()},i.prototype.componentDidUpdate=function(){this.hasRecentItems()&&p(this.logTimeToInteractive)},i.prototype.componentWillUnmount=function(){this.clearLoadNewItemsTimer(),p(this.removeStoreListeners),c.removeListener(this.onRoleUpdate)},i.prototype.createRenderingInfo=function(e,t){return{isUnityAvailable:null===t?this.state.renderingInfo.isUnityAvailable:t,version:this.getVersion(),role:null===e?this.state.role:e}},i.prototype.getRecentItems=function(e){var t=this.getUserId(e||this.state.role);return this.getVersion().getRecentItems(t,this.state.filter)},i.prototype.getCurrentUser=function(){return h.get_viewer().get_user_by_role(this.state.role)},i.prototype.getUserId=function(e){return h.get_viewer().get_user_by_role(e).id},i.prototype.getCurrentUserId=function(){return this.getCurrentUser().id},i.prototype.getVersion=function(){return this.props.version},i.prototype.renderBody=function(){return a.createElement(d.RecentActivityView,{items:this.state.items,filter:this.state.filter,isPending:this.state.isPending,userId:this.getCurrentUserId(),localDatetime:this.props.localDatetime,renderingInfo:this.state.renderingInfo})},i.prototype.render=function(){return this.getVersion().renderRecentActivityContainer(this.renderBody(),this.props.user,this.getCurrentUser(),this.props.removeBasicUploader)},i})(o.ReactPureLogger);_.displayName="RecentActivityContainer",_.defaultProps={initialRole:"personal"},t.RecentActivityContainer=_}),define("modules/clean/recent_activity/react/recent_activity_item_actions_view",["require","exports","tslib","external/classnames","external/react","modules/core/i18n","modules/clean/recent_activity/recent_activity_rendering_models","modules/clean/recent_activity/models/utils"],function(e,t,n,i,r,a,o,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onOpen=function(e){e.preventDefault(),t.getHandler().handleOpen()},t.onDelete=function(e){e.preventDefault(),t.getHandler().handleDelete()},t.onArchive=function(e){e.preventDefault(),t.getHandler().handleArchive()},t.onSelectAll=function(e){e.preventDefault(),t.getHandler().handleSelectAll()},t.onDeselectAll=function(e){e.preventDefault(),t.getHandler().handleDeselectAll()},t.onDownload=function(e){e.preventDefault(),t.getHandler().handleDownload()},t.onComment=function(e){e.preventDefault(),t.getHandler().handleComment()},t.onVersions=function(e){e.preventDefault(),t.props.permissions.versions&&t.getHandler().handleVersions()},t}return n.__extends(t,e),t.prototype.getHandler=function(){return this.props.handler},t.prototype.canOpen=function(){return this.props.permissions.open&&this.props.renderingInfo.isUnityAvailable},t.prototype.canSelect=function(){var e=this.props;return e.attachmentCount>1&&e.selectCount>0&&e.selectCount<e.attachmentCount},t.prototype.canDeselect=function(){return this.props.attachmentCount>1&&this.props.selectCount>0},t.prototype.getDeleteLabel=function(){var e=this.props.selectCount;return e>1?a._("Delete (%(count)s)…").format({count:e}):0===e&&this.props.attachmentCount>1?a._("Delete all…"):a._("Delete…")},t.prototype.getDownloadLabel=function(){var e=this.props.selectCount;return e>1?a._("Download (%(count)s)").format({count:e}):a._("Download")},t.prototype.render=function(){if(this.props.renderingInfo.version.shouldRenderItemActions(this.props.permissions)){var e=i((t={},t["recents-item__more-actions"]=!0,t["recents-item__more-actions--disabled"]=this.props.disableActions,t));return c.isShareLinkEventType(this.props.type)?r.createElement("div",{className:e}):r.createElement("div",{className:e},this.props.renderingInfo.version.renderItemActionsPlaceholder(),r.createElement("div",{className:"recents-item__more-actions-button recents-item__action-button",tabIndex:-1},this.props.renderingInfo.version.renderMoreActionsElement(this)))}return null;var t},t})(r.PureComponent);s.defaultProps={handler:o.getStubRecentActivityItemContainerHandler(),tooltipHandler:o.getStubRecentActivityTooltipHandler(),selectCount:0,attachmentCount:1,disableActions:!1},t.RecentActivityItemActionsView=s}),define("modules/clean/recent_activity/react/recent_activity_item_container",["require","exports","tslib","external/underscore","external/react","modules/core/exception","modules/clean/recent_activity/recent_activity_logger","modules/clean/recent_activity/actions/recent_activity_actions","modules/clean/recent_activity/react/recent_activity_item_view","modules/clean/recent_activity/recent_activity_logger_utils","modules/clean/recent_activity/models/utils","modules/clean/recent_activity/stores/attachment_store","modules/clean/recent_activity/stores/selection_store","modules/clean/react_logger"],function(e,t,n,i,r,a,o,c,s,l,d,u,h,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var p=(function(e){function t(n){var i=e.call(this,t.displayName,n)||this;return i.onSelectionStoreChange=function(){i.setState({selectedAttachmentIds:h.selectionStore.getByRecentItemId(i.getRecentItemId())})},i.onAttachmentStoreChange=function(){i.setState({attachments:i.getAttachmentsFromStore()})},i.handleArchive=function(){i.getVersion().archiveRecentItem(i.getRecentItem(),i.getLogData()),i.clearSelection()},i.handleComment=function(){var e=i.getSingleAttachment("handleComment only supports a single attachment"),t=Math.max(0,i.getStateAttachments().indexOf(e));i.previewOrOpenFiles({index:t,shouldFocusCommentInput:!0})},i.handleDelete=function(){i.getVersion().deleteRecentItem(i.getRecentItem(),i.getSelectedAttachments(),i.getLogData()),i.clearSelection()},i.handleDeselectAll=function(){c.deselectAttachments(i.getRecentItemId(),i.getSelectedAttachmentIds())},i.handleDownload=function(){var e=i.getSingleAttachment("handleDownload only supports a single attachment");c.downloadFiles(i.getViewingUserId(),[e.id],i.getLoggingInfo())},i.handleHeaderClick=function(){if(i.isSubset()){var e=i.state.isCollapsed?o.ActionTypes.UNCOLLAPSE:o.ActionTypes.COLLAPSE;i.getVersion().logEvent(e,i,i.getStateAttachmentFqPaths(),i.getStateAttachments().length)}i.setState({isCollapsed:!i.state.isCollapsed})},i.handleOpen=function(){var e=i.getSingleAttachment("handleOpen only supports a single attachment");c.openFile(i.getViewingUserId(),e.id,i.getLoggingInfo())},i.handlePathClick=function(e){var t=i.getStateAttachmentFqPaths();l.logOpenPathUrl(i.getViewingUserId(),t,i.props.recentItem.attachmentIds.length,i),i.getVersion().handlePathClick(e,i.getRecentItem(),i.getLogData())},i.handlePreview=function(){i.previewOrOpenFiles({shouldFocusCommentInput:!1})},i.handleSelectAll=function(){var e=d.extractAttachmentIds(i.getStateAttachments());c.selectAttachments(i.getRecentItemId(),e)},i.handleShare=function(){i.getVersion().shareRecentItem(i.getRecentItem(),i.getSelectedAttachments(),i.getLogData())},i.handleToggleSelect=function(e,t){t?c.selectAttachments(i.getRecentItemId(),[e.id]):c.deselectAttachments(i.getRecentItemId(),[e.id])},i.handleVersions=function(){var e=i.getSingleAttachment("handleVersions only supports a single attachment");c.openVersions(i.getViewingUserId(),e.id,i.getLoggingInfo())},i.removeStoreListeners=null,i.state={attachments:[],selectedAttachmentIds:[],isCollapsed:!0},i}return n.__extends(t,e),t.prototype.getStateAttachments=function(){return this.state.attachments},t.prototype.getSelectedAttachmentIds=function(){return this.state.selectedAttachmentIds},t.prototype.getVersion=function(){return this.props.renderingInfo.version},t.prototype.isSubset=function(){return this.getRecentItem().uniqueFilterTypes.length>1},t.prototype.getViewingUserId=function(){return this.props.recentItem.viewingUserId},t.prototype.getRecentItem=function(){return this.props.recentItem},t.prototype.getRecentItemId=function(){return this.props.recentItem.id},t.prototype.getLogData=function(){return{totalCount:this.props.recentItem.attachmentIds.length,cellView:this}},t.prototype.getLoggingInfo=function(){return this.getVersion().getLoggingInfo(this.getLogData())},t.prototype.getStateAttachmentFqPaths=function(){return i.compact(i.pluck(this.getStateAttachments(),"fqPath"))},t.prototype.getAttachmentsFromStore=function(){return u.attachmentStore.getByIds(this.getRecentItem().attachmentIds)},t.prototype.getSelectedAttachments=function(){var e=this.getSelectedAttachmentIds();return e.length?this.getStateAttachments().filter(function(t){return e.indexOf(t.id)>=0}):this.getStateAttachments()},t.prototype.getSingleAttachment=function(e){var t=this.getSelectedAttachments();return a.assert(1===t.length,e),t[0]},t.prototype.previewOrOpenFiles=function(e){e.shouldBrowse=d.isShareLinkRecentItem(this.props.recentItem);var t=e.shouldBrowse?[this.getSingleAttachment("previewOrOpenFiles only supports a single shared link")]:this.getStateAttachments();this.getVersion().previewOrBrowseRecentItem(this.getRecentItem(),t,e,this.getLogData())},t.prototype.clearSelection=function(){c.deselectAttachments(this.getRecentItemId(),this.getSelectedAttachmentIds())},t.prototype.componentWillMount=function(){e.prototype.componentWillMount.call(this);var t=h.selectionStore.addListener(this.onSelectionStoreChange),n=u.attachmentStore.addListener(this.onAttachmentStoreChange);this.removeStoreListeners=function(){t(),n()},this.setState({attachments:this.getAttachmentsFromStore(),selectedAttachmentIds:h.selectionStore.getByRecentItemId(this.getRecentItemId())})},t.prototype.componentWillUnmount=function(){this.removeStoreListeners&&this.removeStoreListeners()},t.prototype.render=function(){return r.createElement(s.RecentActivityItemView,{recentItem:this.getRecentItem(),attachments:this.getStateAttachments(),handler:this,isCollapsed:this.state.isCollapsed,selectedAttachmentIds:this.getSelectedAttachmentIds(),renderingInfo:this.props.renderingInfo})},t})(m.ReactPureLogger);p.displayName="RecentActivityItemContainer",t.RecentActivityItemContainer=p}),define("modules/clean/recent_activity/react/recent_activity_item_header_view",["require","exports","tslib","external/classnames","external/react","modules/clean/accessibility/utils","modules/clean/react/helpers","modules/clean/react/file_icon_view","modules/clean/recent_activity/models/utils","modules/clean/recent_activity/recent_activity_view_helper"],function(e,t,n,i,r,a,o,c,s,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onClick=function(e){e.stopPropagation(),e.preventDefault(),t.props.handleClick(e)},t.shouldComponentUpdate=o.compareStateAndProps,t}return n.__extends(t,e),t.prototype.getHeaderProps=function(){return this.props.header},t.prototype.renderIcon=function(){var e=this.getHeaderProps();return r.createElement("div",{className:"recents-item__icon"},r.createElement(c.FileIconView,{icon:e.icon,className:"recents-item__img",src:e.thumbnailUrl}))},t.prototype.renderHeading=function(){return r.createElement("a",n.__assign({ref:"heading",className:"recents-item__heading"},a.accessibleTriggerProps(this.props.handleClick)),this.getHeaderProps().heading)},t.prototype.renderSubheading=function(){var e=this.getHeaderProps().subheading;return e?r.createElement("div",{ref:"subheading",className:"recents-item__subheading"},e):null},t.prototype.renderDetails=function(){return r.createElement("div",{ref:"recentsItemDetails",className:"recents-item__details"},r.createElement("div",{className:"recents-item__heading-group"},this.renderHeading(),this.renderStar()),this.renderSubheading())},t.prototype.renderStar=function(){var e=this.getHeaderProps().star;return e?r.createElement("div",{className:"item__star"},e):null},t.prototype.renderActions=function(){if(this.props.recentActivityType&&s.isShareLinkEventType(this.props.recentActivityType)||0===r.Children.count(this.props.children))return null;var e=i((t={},t["recents-item__actions-inner"]=!0,t["recents-item__actions-inner--tooltip-shown"]=this.props.tooltipShown,t));return r.createElement("div",{ref:"actions",className:"recents-item__actions"},r.createElement("div",{className:e},this.props.children));var t},t.prototype.render=function(){return r.createElement("div",{className:"recents-item__wrapper",onClick:l.ensureUserIntentToClick(this.onClick)},this.renderIcon(),this.renderDetails(),this.renderActions())},t})(r.PureComponent);d.defaultProps={handleClick:function(e){return null},tooltipShown:!1},t.RecentActivityItemHeaderView=d}),define("modules/clean/recent_activity/react/recent_activity_item_view",["require","exports","tslib","external/classnames","external/react","modules/core/i18n","modules/clean/em_string","modules/clean/react/file_path_breadcrumb","modules/clean/react/helpers","modules/clean/recent_activity/actions/recent_activity_action_permissions","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/models/utils","modules/clean/recent_activity/recent_activity_rendering_models","modules/clean/recent_activity/recent_activity_view_helper","modules/clean/recent_activity/recent_activity_text_helper","modules/clean/recent_activity/react/attachment_list_view","modules/clean/recent_activity/react/comment_attachment_view","modules/clean/recent_activity/react/pending_attachment_list_view","modules/clean/recent_activity/react/recent_activity_item_header_view","modules/clean/recent_activity/react/recent_activity_item_actions_view","modules/clean/recent_activity/react/doc_attachment_list_view","modules/clean/react_logger"],function(e,t,n,i,r,a,o,c,s,l,d,u,h,m,p,_,f,g,v,y,I,E){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var A=(function(e){function t(n){var i=e.call(this,t.displayName,n)||this;return i.onDisabled=function(e){e.preventDefault()},i.handleBlur=function(){i.setState({isFocused:!1})},i.handleFocus=function(){i.setState({isFocused:!0})},i.handleMouseEnter=function(){i.setState({isHovered:!0})},i.handleMouseLeave=function(){i.setState({isHovered:!1})},i.onShare=function(e){e.preventDefault(),i.getHandler().handleShare()},i.onSelectAll=function(e){e.preventDefault(),i.getHandler().handleSelectAll()},i.onShowTooltip=function(){i.setState({tooltipShown:!0})},i.onHideTooltip=function(){i.setState({tooltipShown:!1})},i.shouldComponentUpdate=s.compareStateAndProps,i.state={tooltipShown:!1,isFocused:!1,isHovered:!1},i}return n.__extends(t,e),t.prototype.getRecentItem=function(){return this.props.recentItem},t.prototype.getAttachments=function(){return this.props.attachments},t.prototype.getHandler=function(){return this.props.handler},t.prototype.getSelectedAttachmentIds=function(){return this.props.selectedAttachmentIds},t.prototype.shouldDisableActions=function(){var e=this.getRecentItem().federatedRecentItem;return e?!e.hasMenuActions():!this.hasLoadedAttachments()},t.prototype.isAggregation=function(){return this.props.recentItem.attachmentIds.length>1},t.prototype.shouldShowComment=function(){var e=this.getAttachments()[0];return!(!e||!e.commentRawText)},t.prototype.shouldShowThumbnails=function(){var e=this.getRecentItem();return!u.isShareLinkRecentItem(e)&&u.shouldShowThumbnailsForRecentItem(e)},t.prototype.getLoadedAttachmentsCount=function(){return this.getAttachments().filter(function(e){return e.isLoaded}).length},t.prototype.canRenderAttachmentView=function(){var e=this.getLoadedAttachmentsCount();return e===this.getRecentItem().attachmentIds.length||e>=d.MAX_INITIAL_THUMBNAIL_ATTACHMENTS},t.prototype.hasLoadedAttachments=function(){return!(!this.getAttachments().length||!this.getLoadedAttachmentsCount())},t.prototype.getHeading=function(){var e=this.getAttachments();if(e.length<2)return o.em_snippet(this.getRecentItem().displayName||"",30);for(var t=this.getRecentItem(),n=t.attachmentIds.length,i=t.uniqueFilterTypes,r=[],c=0,s=e;c<s.length;c++){var l=s[c];l.isLoaded&&l.displayName&&r.push(l.displayName)}switch(i.length){case 1:switch(i[0]){case d.RECENT_EVENT_FILTER_TYPE.PHOTOS:return a.ungettext("%(count)s image","%(count)s images",n).format({count:n});case d.RECENT_EVENT_FILTER_TYPE.VIDEOS:return a.ungettext("%(count)s video","%(count)s videos",n).format({count:n});case d.RECENT_EVENT_FILTER_TYPE.VISUAL_NOTES:return a.ungettext("%(count)s visual note","%(count)s visual notes",n).format({count:n})}break;case 2:if(i.indexOf(d.RECENT_EVENT_FILTER_TYPE.PHOTOS)>=0&&i.indexOf(d.RECENT_EVENT_FILTER_TYPE.VIDEOS)>=0)return a._("%(count)s images and videos").format({count:n})}return r.length?p.snippetList(r,30,{totalCount:n}):a.ungettext("%(count)s file","%(count)s files",n).format({count:n})},t.prototype.getSubheading=function(){var e=this.getRecentItem();return u.isShareLinkRecentItem(this.props.recentItem)?e.type===d.RECENT_EVENT_TYPES.FILE_SHARED_ADD?r.createElement("a",{className:"recents-item__subheading-path",href:"/links/your_links",onClick:this.getHandler().handlePathClick},a._("Your links")):r.createElement("div",{className:"recents-item__subheading"},r.createElement("span",{className:"recents-item__subheading-path"},a._("Recently viewed"))):e.paths.length?r.createElement(c.FilePathBreadcrumb,{pathClassname:"recents-item__subheading-path",handlePathClick:this.getHandler().handlePathClick,paths:e.paths}):null},t.prototype.getIcon=function(){var e=this.getRecentItem(),t=e.icon+"_32";if(e.attachmentIds.length>1){for(var n=0,i=this.getAttachments();n<i.length;n++){
var r=i[n];if(r.previewInfo){t=r.previewInfo.icon;break}}t=t.replace(/_32$/,"_stack_32")}return t},t.prototype.getThumbnailUrl=function(){var e=this.getAttachments();return 1===e.length&&e[0].thumbnailUrl||void 0},t.prototype.renderShareButton=function(){var e=this.props.renderingInfo.version.getShareButtonVisibility(this.getRecentItem(),this.hasLoadedAttachments());if(e!==d.RecentElementVisibilities.HIDDEN){var t=i({disabled:e===d.RecentElementVisibilities.DISABLED,"button-secondary":!0,"recents-item__share-link":!0});return r.createElement("a",{ref:"shareLink",className:t,href:"#share",onClick:e===d.RecentElementVisibilities.SHOWN?this.onShare:this.onDisabled},a._("Share"))}return null},t.prototype.renderAttachments=function(){return this.shouldShowThumbnails()?this.canRenderAttachmentView()?r.createElement(_.AttachmentListView,{ref:"attachments",attachments:this.getAttachments(),handleToggleSelect:this.getHandler().handleToggleSelect,selectedAttachmentIds:this.getSelectedAttachmentIds(),renderingInfo:this.props.renderingInfo}):r.createElement(g.PendingAttachmentListView,{ref:"pendingAttachments",count:this.getRecentItem().attachmentIds.length}):this.isAggregation()?r.createElement(I.DocAttachmentListView,{ref:"docAttachments",recentItem:this.getRecentItem(),attachments:this.getAttachments(),isCollapsed:this.props.isCollapsed,renderingInfo:this.props.renderingInfo}):this.shouldShowComment()?r.createElement(f.CommentAttachmentView,{ref:"commentAttachment",attachment:this.getAttachments()[0],handlePreview:this.getHandler().handlePreview}):null},t.prototype.renderActions=function(e){return r.createElement(y.RecentActivityItemActionsView,{ref:"recentsItemActionsView",handler:this.getHandler(),tooltipHandler:this,type:this.getRecentItem().type,permissions:e,selectCount:this.getSelectedAttachmentIds().length,attachmentCount:this.getRecentItem().attachmentIds.length,disableActions:this.shouldDisableActions(),rowIsHovered:this.state.isHovered,renderingInfo:this.props.renderingInfo})},t.prototype.renderButton=function(e){var t=this.shouldDisableActions(),n=this.props.renderingInfo.version.maybeRenderSelectAllButton(this.shouldShowThumbnails(),this.getRecentItem(),this.getSelectedAttachmentIds(),t?this.onDisabled:this.onSelectAll,t);return n?n:e.share?r.createElement("div",{className:"recents-item__sharing recents-item__action-button"},this.renderShareButton()):null},t.prototype.getHeaderProps=function(){return{heading:this.getHeading(),subheading:this.getSubheading(),icon:this.getIcon(),thumbnailUrl:this.getThumbnailUrl(),star:this.props.renderingInfo.version.renderStar(this.props.renderingInfo.role,this.getRecentItem())}},t.prototype.renderHeader=function(){var e=l.getRecentActivityItemViewPermissions(this.getRecentItem(),this.getAttachments(),this.getSelectedAttachmentIds());return r.createElement(v.RecentActivityItemHeaderView,{ref:"header",header:this.getHeaderProps(),handleClick:this.isAggregation()?this.getHandler().handleHeaderClick:this.getHandler().handlePreview,tooltipShown:this.state.tooltipShown,recentActivityType:this.getRecentItem().type},this.renderButton(e),this.renderActions(e))},t.prototype.render=function(){var e=i((a={},a["recents-item"]=!0,a["recents-item--focused-in"]=this.state.isFocused,a["recents-item--loaded"]=this.hasLoadedAttachments(),a)),t=this.shouldShowThumbnails()||!this.isAggregation()?m.ensureUserIntentToClick(this.getHandler().handlePreview):void 0,n=this.getRecentItem();return r.createElement("li",{"data-item-id":n.id,"data-item-type":n.type,"data-item-date":n.when,className:e,onClick:t,onBlur:this.handleBlur,onFocus:this.handleFocus,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave},this.renderHeader(),this.renderAttachments());var a},t})(E.ReactPureLogger);A.displayName="RecentActivityItemView",A.defaultProps={handler:h.getStubRecentActivityItemContainerHandler(),isCollapsed:!0,attachments:[],selectedAttachmentIds:[]},t.RecentActivityItemView=A}),define("modules/clean/recent_activity/react/recent_activity_list_view",["require","exports","tslib","external/classnames","external/react","modules/clean/react_logger","modules/clean/recent_activity/react/recent_activity_item_container"],function(e,t,n,i,r,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=(function(e){function t(t){return e.call(this,"RecentActivityListView",t)||this}return n.__extends(t,e),t.prototype.render=function(){var e=this.props.renderingInfo,t=this.props.items.map(function(t){return r.createElement(o.RecentActivityItemContainer,{key:t.id,recentItem:t,renderingInfo:e})});return r.createElement("ul",{className:i({"recents-list":!0,"recents-list--is-pending":this.props.isPending&&0===t.length})},t)},t})(a.ReactLogger);t.RecentActivityListView=c}),define("modules/clean/recent_activity/react/recent_activity_view",["require","exports","tslib","external/classnames","external/react","modules/clean/components/loading_indicator","modules/clean/react_logger","modules/clean/recent_activity/recent_activity_constants"],function(e,t,n,i,r,a,o,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=(function(e){function t(n){return e.call(this,t.displayName,n)||this}return n.__extends(t,e),t.prototype.renderLoadingView=function(){return r.createElement("div",{className:"recents-loading-view",key:"loading"},r.createElement(a,{style:a.LoadingIndicatorStyle.BLUE_SPINNER,className:"recents-loading-indicator"}))},t.prototype.renderItems=function(){return this.props.renderingInfo.version.renderItems({items:this.props.items,renderingInfo:this.props.renderingInfo,isPending:this.props.isPending,localDatetime:this.props.localDatetime})},t.prototype.renderPendingContent=function(){return[this.renderLoadingView(),this.renderItems()]},t.prototype.renderBlankSlateContent=function(){return[this.props.renderingInfo.version.renderEmptyState(this.props.filter)]},t.prototype.renderLoadedContent=function(){return[this.renderItems(),this.props.isPending?this.renderLoadingView():null]},t.prototype.renderContent=function(){return this.props.items.length?this.renderLoadedContent():this.props.isPending?this.renderPendingContent():this.renderBlankSlateContent()},t.prototype.render=function(){var e=i({"recents-view":!0,"recents-view--is-pending":this.props.isPending&&0===this.props.items.length});return r.createElement("div",{className:e},this.renderContent())},t})(o.ReactPureLogger);s.displayName="RecentActivityView",s.defaultProps={filter:c.RECENT_EVENT_FILTER_TYPE.ALL,isPending:!1},t.RecentActivityView=s}),define("modules/clean/recent_activity/react/selectable_view",["require","exports","tslib","external/react","modules/clean/accessibility/utils","modules/clean/react/sprite","modules/core/i18n"],function(e,t,n,i,r,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handletoggleSelected=function(e){e.preventDefault(),e.stopPropagation(),t.props.handleToggleSelect(t.props.id,!t.props.isSelected)},t}return n.__extends(t,e),t.prototype.render=function(){var e=this.props.isSelected?o._("Deselect"):o._("Select");return i.createElement("a",n.__assign({},r.accessibleTriggerProps(this.handletoggleSelected),{className:"attachment-item__checkmark"}),i.createElement("span",{className:"attachment-item__checkmark-inner"},i.createElement(a,{group:"web",name:"white_check",alt:e})))},t})(i.PureComponent);c.defaultProps={isSelected:!1,handleToggleSelect:function(){}},t.SelectableView=c}),define("modules/clean/recent_activity/recent_activity_client",["require","exports","tslib","jquery","external/underscore","modules/clean/ajax","modules/constants/python","modules/core/exception","external/tracekit"],function(e,t,n,i,r,a,o,c,s){"use strict";function l(e,t){return function(n){"ok"===n.status?t(n.payload):e.reject(new Error("Payload not okay: "+n))}}function d(e){return"    "+e}function u(e){return e.split("\n").map(d).join("\n")}function h(e,t){return"abort"!==t&&0!==e.status}function m(e,t){return function(n,i,r){var a="\n      Failed XHR request for "+t+":\n      Exception: "+(r.stack?r:"")+"\n      Response Status: "+JSON.stringify(n.status)+" "+n.statusText+"\n      Response Headers:\n"+u(n.getAllResponseHeaders()||"[No Headers]")+"\n      Response Body:\n"+u(n.responseText?"[No Body]":"")+"\n      ";if(h(n,i)){var o=[],l=s.computeStackTrace(r);l&&l.stack&&(o=l.stack),c._reportException({msg:a,tags:["recents"],severity:r instanceof Error?c.SEVERITY.CRITICAL:c.SEVERITY.NONCRITICAL,stack:o})}e.reject(new T(a,n))}}function p(e){return function(t,n,i){if(h(t,n))throw new Error("Failed XHR request for "+e+": "+i)}}function _(e){return e?a.SilentBackgroundRequest:a.WebRequest}function f(e,t){void 0===t&&(t={});var n=i.Deferred();return _(t.isBackgroundRequest)({url:"/recents/json",type:"POST",subject_user:e,data:{num_activities:20,cursor:t.cursor},dataType:"json",success:l(n,function(e){n.resolve({recentActivities:e.recent_activities,cursor:e.cursor,encrypted:e.encrypted})}),error:m(n,"/recents/json")}),n.promise()}function g(e,t,n){void 0===n&&(n=!1);var r=i.Deferred();return _(n)({url:"/home_feed/retrieve_paper_recents",type:"POST",subject_user:e,data:{is_initial_fetch:t},dataType:"json",success:l(r,function(e){r.resolve({items:e.items,hasMore:e.has_more})}),error:m(r,"/home_feed/retrieve_paper_recents")}),r.promise()}function v(e,t,n){var o=i.Deferred();return a.SilentBackgroundRequest({url:"/activity/generate/json",type:"POST",subject_user:e,data:{activity_keys:JSON.stringify(r.unique(t)),loading_modes:JSON.stringify([R.PREVIEW_INFO]),encrypted:n},dataType:"json",success:l(o,function(e){o.resolve(e.activities_by_activity_key)}),error:m(o,"/activity/generate/json")}),o.promise()}function y(e,t){a.SilentBackgroundRequest({url:"/recents/logger",type:"POST",subject_user:e,data:t,error:p("/recents/logger")})}function I(e,t){var n=i.Deferred();return a.SilentBackgroundRequest({url:"/recents/check_files_in_root_collection",type:"POST",subject_user:e,data:{files_json:JSON.stringify(t)},dataType:"json",success:l(n,function(e){n.resolve({fileInRootCollectionInfo:e.file_in_root_collection_info})}),error:m(n,"/recents/check_files_in_root_collection")}),n.promise()}function E(e,t){var n=i.Deferred();return a.WebRequest({url:"/home_feed/archive_paper_resources",type:"POST",subject_user:e,data:{resources_json:JSON.stringify(t)},dataType:"json",success:l(n,function(e){return n.resolve(e)}),error:m(n,"/home_feed/archive_paper_resources")}),n.promise()}function A(e,t){var n=i.Deferred();return a.WebRequest({url:"/recents/create_collection_shared_link",type:"POST",subject_user:e,data:{files_json:JSON.stringify(t)},dataType:"json",success:l(n,function(e){n.resolve({link:e.link,tkey:e.tkey,shareableItemCount:e.shareable_item_count})}),error:m(n,"/recents/create_collection_shared_link")}),n.promise()}Object.defineProperty(t,"__esModule",{value:!0});var R=o.FILE_ACTIVITY_LOADING_MODE,T=(function(e){function t(t,n){var i=e.call(this,t)||this;return i.xhr=n,i}return n.__extends(t,e),t})(Error);t.fetchRecentActivities=f,t.fetchPaperRecents=g,t.fetchActivitiesByKey=v,t.postLogEvent=y,t.checkFileInRootCollection=I,t.archivePaperResources=E,t.createCollectionSharedLink=A}),define("modules/clean/recent_activity/recent_activity_constants",["require","exports","modules/constants/python"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RECENT_EVENT_TYPES=n.RECENT_EVENT_TYPES,t.RECENT_EVENT_FILTER_TYPE=n.RECENT_EVENT_FILTER_TYPE,t.RECENT_CREATE_FILTER="createFilter",t.ARCHIVE_PAPER_DOCUMENT_COMMIT="ARCHIVE_PAPER_DOCUMENT_COMMIT",t.ARCHIVE_PAPER_DOCUMENT_PENDING="ARCHIVE_PAPER_DOCUMENT_PENDING",t.ARCHIVE_PAPER_DOCUMENT_ROLLBACK="ARCHIVE_PAPER_DOCUMENT_ROLLBACK",t.DELETE_FILES_COMMIT="DELETE_FILES_COMMIT",t.DELETE_FILES_PENDING="DELETE_FILES_PENDING",t.DELETE_FILES_ROLLBACK="DELETE_FILES_ROLLBACK",t.DESELECT_ATTACHMENTS="DESELECT_ATTACHMENTS",t.RAW_RECENT_ACTIVITY_PARSE_ERROR="RAW_RECENT_ACTIVITY_PARSE_ERROR",t.RAW_RELATED_ACTIVITY_PARSE_ERROR="RAW_RELATED_ACTIVITY_PARSE_ERROR",t.RECEIVE_CAN_OPEN_INFO="RECEIVE_CAN_OPEN_INFO",t.RECEIVE_FILE_IN_ROOT_COLLECTION_INFO="RECEIVE_FILE_IN_ROOT_COLLECTION_INFO",t.RECEIVE_PAPER_RECENT_ITEMS="RECEIVE_PAPER_RECENT_ITEMS",t.RECEIVE_RAW_RECENT_ACTIVITIES="RECEIVE_RAW_RECENT_ACTIVITIES",t.RECEIVE_RAW_RELATED_ACTIVITIES_BY_KEY="RECEIVE_RAW_RELATED_ACTIVITIES_BY_KEY",t.SELECT_ATTACHMENTS="SELECT_ATTACHMENTS",t.MAX_INITIAL_DOC_ATTACHMENTS=3,t.SHOW_MORE_DOC_ATTACHMENT_INCREMENT=10,t.MAX_INITIAL_THUMBNAIL_ATTACHMENTS=8,t.SHOW_MORE_THUMBNAIL_ROW_INCREMENT=4,t.PaperRecentItemTypes={DOCUMENT:"DOCUMENT",FOLDER:"FOLDER",PROJECT:"PROJECT"},t.MAX_RECENT_ITEM_COUNT_ON_RECENTS_V2_PRE_TTI=10,t.MAX_RECENT_ITEM_COUNT_ON_RECENTS_V2_POST_TTI=100,t.FederatedOrigins={PAPER:"PAPER"},t.RecentElementVisibilities={SHOWN:"SHOWN",HIDDEN:"HIDDEN",DISABLED:"DISABLED"}}),define("modules/clean/recent_activity/recent_activity_dispatcher",["require","exports","external/flux"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.recentActivityDispatcher=new n.Dispatcher}),define("modules/clean/recent_activity/recent_activity_logger",["require","exports","tslib","external/underscore","modules/clean/recent_activity/recent_activity_client","modules/core/exception"],function(e,t,n,i,r,a){"use strict";function o(e,t,i){if(void 0===i&&(i={}),E){var a=n.__assign({},i,{event_name:t});r.postLogEvent(e,a)}}function c(e,t,n){var r=i.keys(n),o=i.difference(r,t);a.assert(0===o.length,e+" called with unsupported keys: "+o)}function s(){E=!0}function l(){E=!1}function d(){return E}function u(e,t){c("logPageLoaded",f,t),o(e,"client_page_loaded",t)}function h(e,t){c("logRequestFailed",g,t),o(e,"request_failed",t)}function m(e,t){c("logCellAction",v,t),o(e,"cell_action",t)}function p(e,t){c("logTimeToFirstAction",y,t),o(e,"time_to_first_action",t)}function _(e,t){c("logOnboardingAction",I,t),o(e,"onboarding_action",t)}Object.defineProperty(t,"__esModule",{value:!0});t.ActionScopes={SINGLE:"single",SUBSET:"subset",AGGREGATION:"aggregation"},t.ActionTypes={VIEW_FILE:"view",OPEN:"open",SHARE:"share",SHARE_COLLECTION:"share_collection",DELETE:"delete",HIDE:"hide",UNITY_OPEN:"unity_open",OPEN_DIR:"open_dir",OPEN_PATH:"open_path",REPORT_JUNK:"report_junk",COMMENT:"comment",DOWNLOAD:"download",VERSIONS:"versions",VIEW_SHARED_LINK:"view_shared_link",PAPER_ARCHIVE:"paper_archive",PAPER_OPEN:"paper_open",PAPER_SHARE:"paper_share",COLLAPSE:"collapse",UNCOLLAPSE:"uncollapse",ONBOARDING_DISMISSED:"onboarding_dismissed",FULL_ONBOARDING_OPENED:"full_onboarding_opened",FULL_ONBOARDING_DISMISSED:"full_onboarding_dismissed"},t.FilterViews={EVERYTHING:"everything"};var f=["is_full_page","item_count","contains_aggregation","latency","is_paginated"],g=["failure_type","is_paginated"],v=["in_aggregation","filter_view","action_type","target_activity_type","action_scope","position","file_extension","days_ago"],y=["latency","action_type","action_scope"],I=["action_type"],E=!0;t.enableLogging=s,t.disableLogging=l,t.isLoggingEnabled=d,t.logPageLoaded=u,t.logRequestFailed=h,t.logCellAction=m,t.logTimeToFirstAction=p,t.logOnboardingAction=_}),define("modules/clean/recent_activity/recent_activity_logger_utils",["require","exports","tslib","external/react-dom","external/underscore","jquery","modules/clean/recent_activity/recent_activity_logger","modules/clean/web_timing_logger"],function(e,t,n,i,r,a,o,c){"use strict";function s(e){return Math.floor((Date.now()-e)/864e5)}function l(e,t,n,c,l){var u,h=a(i.findDOMNode(l)),m=h.closest(".recents-item"),p=r.uniq(r.map(n,function(e){return null!=e?e.split(".").pop().toLowerCase():void 0})).filter(Boolean),_=c>1;u=1===c?E.SINGLE:n.length===c?E.AGGREGATION:E.SUBSET;var f={in_aggregation:_,filter_view:y.EVERYTHING,action_type:e,action_scope:u,target_activity_type:m.data("item-type"),position:m.prevAll().length,file_extension:p.join(","),days_ago:s(m.data("item-date"))};o.logCellAction(t,f),d(t,r.pick(f,"action_scope","action_type"))}function d(e,t){if(!A){var i=c.start_time();i&&(A=!0,o.logTimeToFirstAction(e,n.__assign({},t,{latency:Date.now()-i})))}}function u(e){return function(t,n,i,r){l(e,t,n,i,r)}}function h(e){return function(t,n,i,r){return u(e)(t,[n],i,r)}}function m(e){o.logOnboardingAction(e,{action_type:"onboarding_dismissed"})}function p(e){o.logOnboardingAction(e,{action_type:"full_onboarding_opened"})}function _(e){o.logOnboardingAction(e,{action_type:"full_onboarding_dismissed"})}function f(e,t){o.logRequestFailed(e,{failure_type:t.status,is_paginated:!1})}function g(){var e=Date.now(),t=!1;if(!R){var i=c.start_time();i&&(t=!0,e=i,R=!0)}return function(i,r){void 0===r&&(r={});var a=n.__assign({is_full_page:t},r,{latency:Date.now()-e});o.logPageLoaded(i,a)}}function v(){R=A=!1}Object.defineProperty(t,"__esModule",{value:!0});var y=o.FilterViews,I=o.ActionTypes,E=o.ActionScopes,A=!1,R=!1;t.logShareFile=h(I.SHARE),t.logShareCollection=u(I.SHARE_COLLECTION),t.logPreviewFiles=u(I.VIEW_FILE),t.logDeleteFiles=u(I.DELETE),t.logUnityOpenFile=h(I.UNITY_OPEN),t.logOpenPathUrl=u(I.OPEN_DIR),t.logOpenSharedLinkUrl=u(I.VIEW_SHARED_LINK),t.logCommentFile=h(I.COMMENT),t.logDownloadFile=u(I.DOWNLOAD),t.logOpenVersions=h(I.VERSIONS),t.logOnboardingClosed=m,t.logOnboardingLearnMore=p,t.logOnboardingModalClosed=_,t.logRequestFailed=f,t.startRequestTimer=g,t.reset=v}),define("modules/clean/recent_activity/recent_activity_prefetch",["require","exports","jquery","modules/clean/recent_activity/store_utils"],function(e,t,n,i){"use strict";function r(e,t){void 0===t&&(t=!1);var n=window;a(e,n.__REGISTER_RECENTS_PRELOAD_HANDLER),t&&o(e,n.__REGISTER_PAPER_RECENTS_PRELOAD_HANDLER)}function a(e,t){t?t(function(t){var r=n.Deferred();r.resolve({recentActivities:t.payload.recent_activities,cursor:t.payload.cursor,encrypted:t.payload.encrypted}),i.handleAndLogFetchRecentActivitiesPromise(r.promise(),e)},function(){return i.loadRecentItems(e)}):i.loadRecentItems(e)}function o(e,t){t?t(function(t){var r=n.Deferred();r.resolve({items:t.payload.items,hasMore:t.payload.has_more}),i.handleFetchPaperRecentsPromise(r.promise(),e,!0)},function(){return i.loadPaperRecentItems(e,!0)}):i.loadPaperRecentItems(e,!0)}Object.defineProperty(t,"__esModule",{value:!0}),t.preloadRecentItems=r}),define("modules/clean/recent_activity/recent_activity_rendering_models",["require","exports"],function(e,t){"use strict";function n(){return{handleArchive:function(){},handleComment:function(){},handleDelete:function(){},handleDeselectAll:function(){},handleDownload:function(){},handleHeaderClick:function(){},handleOpen:function(){},handlePathClick:function(){},handlePreview:function(){},handleSelectAll:function(){},handleShare:function(){},handleToggleSelect:function(e,t){},handleVersions:function(){}}}function i(){return{onShowTooltip:function(){},onHideTooltip:function(){}}}Object.defineProperty(t,"__esModule",{value:!0}),t.getStubRecentActivityItemContainerHandler=n,t.getStubRecentActivityTooltipHandler=i}),define("modules/clean/recent_activity/recent_activity_text_helper",["require","exports","modules/clean/em_string","modules/core/i18n"],function(e,t,n,i){"use strict";function r(e,t){return i.ungettext("%(name)s and %(num)s other","%(name)s and %(num)s others",t).format({name:e,num:t})}function a(e,t,a){void 0===a&&(a={});var o=Math.max(Math.floor(a.totalCount||0),e.length);if(1===o)return n.em_snippet(e[0],t);var c=e[0],s=o-1,l=r(c,s);if(new n(l).length>t){var d=Math.floor(t-new n(r("",s)).length)-1;l=d<3?i.ungettext("%(num)s other","%(num)s others",o).format({num:o}):r(n.em_snippet(c,d),s)}for(var u="",h=1;h<e.length&&(h+=1,u=e.slice(0,h).join(", "),h<o&&(u=r(u,o-h)),new n(u).length<t);)l=u;return l}Object.defineProperty(t,"__esModule",{value:!0}),t.snippetList=a}),define("modules/clean/recent_activity/recent_activity_view_helper",["require","exports"],function(e,t){"use strict";function n(e){return function(t){if(!window.getSelection().toString()){for(var n=t.target;n&&n.parentNode&&n!==t.currentTarget;){if(["a","button"].indexOf(n.nodeName.toLowerCase())>=0)return;n=n.parentNode}e.apply(this,arguments)}}}Object.defineProperty(t,"__esModule",{value:!0}),t.ensureUserIntentToClick=n}),define("modules/clean/recent_activity/store_utils",["require","exports","jquery","external/underscore","modules/core/i18n","modules/clean/recent_activity/stores/attachment_store","modules/clean/web_timing_logger","modules/core/notify","modules/clean/recent_activity/recent_activity_dispatcher","modules/clean/recent_activity/recent_activity_logger_utils","modules/clean/recent_activity/recent_activity_client","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/models/utils"],function(e,t,n,i,r,a,o,c,s,l,d,u,h){"use strict";function m(e,t){return void 0===t&&(t={}),p(d.fetchRecentActivities(e,t),e,t.cursor)}function p(e,t,n){var i=l.startRequestTimer(),r=e.then(function(e){return f(t,e)}).then(function(){},_(t));return e.then(function(e){return r.then(function(){var r=!1,a=0;e.recentActivities.forEach(function(e){e.skeleton_data&&(a+=e.skeleton_data.num_related_activities||0,(e.skeleton_data.num_related_activities||0)>1&&(r=!0))}),i(t,{is_paginated:!!n,contains_aggregation:r,item_count:a})})})}function _(e){return function(t){l.logRequestFailed(e,t)}}function f(e,t){return g(e,t.recentActivities,t.cursor,t.encrypted),v(e,t.recentActivities)}function g(e,t,n,i){s.recentActivityDispatcher.dispatch({type:u.RECEIVE_RAW_RECENT_ACTIVITIES,rawRecentActivities:t,cursor:n||"",encrypted:i||"",userId:e})}function v(e,t){var i=[];return t.forEach(function(e){if(e.skeleton_data&&e.related_activity_keys){var t=h.shouldShowThumbnailsForSkeletonData(e.skeleton_data)?u.MAX_INITIAL_THUMBNAIL_ATTACHMENTS:u.MAX_INITIAL_DOC_ATTACHMENTS;e.related_activity_keys.slice(0,t).forEach(function(e){return i.push(e)})}}),n.Deferred(function(t){return o.waitForTTI().then(function(){return E(e,i).then(function(e){return t.resolve(e)})})})}function y(e,t,n){void 0===n&&(n=!1),I(d.fetchPaperRecents(e,t,n),e,t)}function I(e,t,n){e.then(function(e){var i=n&&e.hasMore;s.recentActivityDispatcher.dispatch({type:u.RECEIVE_PAPER_RECENT_ITEMS,items:e.items,hasMore:i,userId:t}),i&&o.waitForTTI().then(function(){return y(t,!1)})},_(t))}function E(e,t){var r=a.attachmentStore.groupIdsByEncryptedToken(t),o=i.map(r,function(t,n){return d.fetchActivitiesByKey(e,t,n).then(function(t){return A(e,t)})});return n.when.apply(n,o).then(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n={};return e.forEach(function(e){i.map(e,function(e,t){n[t]=e})}),n})}function A(e,t){return s.recentActivityDispatcher.dispatch({type:u.RECEIVE_RAW_RELATED_ACTIVITIES_BY_KEY,rawRelatedActivitiesByKey:t,userId:e}),R(t,e),S(t,e),t}function R(e,t){if(e){T(w(e),t).then(function(e){s.recentActivityDispatcher.dispatch({type:u.RECEIVE_CAN_OPEN_INFO,canOpenInfo:e})})}}function T(t,r){var a=n.Deferred();return e(["modules/clean/unity/features"],function(e){i.isUndefined(e)||e.check_file_batch(t,r).then(function(e){a.resolve(e)})}),a.promise()}function w(e){return i.values(e).map(function(e){return{ns_id:e.ns_id,ns_path:e.ns_path}})}function S(e,t){if(e){var n=w(e);d.checkFileInRootCollection(t,n).then(function(e){s.recentActivityDispatcher.dispatch({type:u.RECEIVE_FILE_IN_ROOT_COLLECTION_INFO,fileInRootCollectionInfo:e.fileInRootCollectionInfo})})}}function C(e,t,n){var o=a.attachmentStore.getByIds(t),s=o.filter(function(e){return!e.isLoaded}).map(function(e){return e.id});s.length?E(e,s).then(function(){return C(e,t,n)},function(){return c.error(r._("There was a problem completing this request."))}):i.defer(function(){return n(o)})}Object.defineProperty(t,"__esModule",{value:!0}),t.loadRecentItems=m,t.handleAndLogFetchRecentActivitiesPromise=p,t.getOnFail=_,t.updateRecentActivities=g,t.loadAttachmentsForRecentActivities=v,t.loadPaperRecentItems=y,t.handleFetchPaperRecentsPromise=I,t.loadAttachments=E,t.ensureAttachments=C}),define("modules/clean/recent_activity/stores/attachment_store",["require","exports","tslib","external/underscore","modules/clean/flux/flux_store","modules/clean/recent_activity/actions/error_actions","modules/clean/recent_activity/stores/flux_utils","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/recent_activity_dispatcher","modules/clean/recent_activity/models/attachment","modules/core/exception"],function(e,t,n,i,r,a,o,c,s,l,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=(function(e){function t(t,n){void 0===n&&(n={});var i=e.call(this,t)||this;return i.onCommit=function(e){delete i.transactionHistory[e.transactionId]},i._onDeleteFilesPending=function(e){for(var t=[],n=0,r=e.attachmentIds;n<r.length;n++){var a=r[n];a in i.attachmentIdToAttachment&&(t.push(i.attachmentIdToAttachment[a]),delete i.attachmentIdToAttachment[a])}i.transactionHistory[e.transactionId]={deletedAttachments:t},o.emitChangeIfNeeded(i,!!t.length)},i._onDeleteFilesRollback=function(e){var t=i.transactionHistory[e.transactionId];d.assert(!!t,"Unable to find data for transaction with id: "+e.transactionId),t.deletedAttachments.forEach(function(e){return i.attachmentIdToAttachment[e.id]=e}),o.emitChangeIfNeeded(i,!!t.deletedAttachments.length)},i.attachmentIdToEncryptedToken={},i.attachmentIdToAttachment={},(n.attachments||[]).forEach(function(e){i.attachmentIdToAttachment[e.id]=e,n.encryptedToken&&(i.attachmentIdToEncryptedToken[e.id]=n.encryptedToken)}),i.transactionHistory={},i}return n.__extends(t,e),t.prototype.getById=function(e){return this.attachmentIdToAttachment[e]||null},t.prototype.getByIds=function(e){return i.values(i.pick(this.attachmentIdToAttachment,e))},t.prototype.getByFqPath=function(e){return this.getAll().find(function(t){return t.fqPath===e})||null},t.prototype.getAll=function(){return i.values(this.attachmentIdToAttachment)},t.prototype.groupIdsByEncryptedToken=function(e){var t=this;return i.groupBy(e.filter(function(e){return e in t.attachmentIdToEncryptedToken}),function(e){return t.attachmentIdToEncryptedToken[e]})},t.prototype.__onDispatch=function(e){switch(e.type){case c.DELETE_FILES_COMMIT:this.onCommit(e);break;case c.DELETE_FILES_PENDING:this._onDeleteFilesPending(e);break;case c.DELETE_FILES_ROLLBACK:this._onDeleteFilesRollback(e);break;case c.RECEIVE_RAW_RECENT_ACTIVITIES:this.onReceiveRawRecentActivities(e);break;case c.RECEIVE_RAW_RELATED_ACTIVITIES_BY_KEY:this.onReceiveRawRelatedActivitiesByKey(e);break;case c.RECEIVE_CAN_OPEN_INFO:this._onReceiveCanOpenInfo(e);break;case c.RECEIVE_FILE_IN_ROOT_COLLECTION_INFO:this._onReceiveFileInRootCollectionInfo(e)}},t.prototype.mutateAttachmentInNsIdPath=function(e,t){if(e&&e.indexOf(":")>=0){var n=e.split(":"),i=n[0],r=n[1],a=this.getAll().find(function(e){return e.nsId===Number(i)&&e.nsPath===r})||null;if(a){var c=o.getMutatedOrOriginal(a,t);if(c!==a)return this.attachmentIdToAttachment[a.id]=c,!0}}return!1},t.prototype.onReceiveRawRecentActivities=function(e){var t=this,n=e.rawRecentActivities.map(l.createPartialAttachmentsFromRecentActivity),i=(r=[]).concat.apply(r,n).filter(function(e){var n=t.getById(e.id);return!n||!n.isLoaded});i.forEach(function(n){t.attachmentIdToAttachment[n.id]=n,t.attachmentIdToEncryptedToken[n.id]=e.encrypted}),o.emitChangeIfNeeded(this,!!i.length);var r},t.prototype.onReceiveRawRelatedActivitiesByKey=function(e){var t=this;e.rawRelatedActivitiesByKey&&o.iterateAndEmitChangesIfNeeded(this,e.rawRelatedActivitiesByKey,function(e,n){try{var r=l.convertFileActivityToAttachmentItem(e);return t.attachmentIdToAttachment[r.id]=r,!0}catch(e){return i.defer(function(){return a.errorActions.relatedActivityParseError(n,e)}),!1}})},t.prototype._onReceiveCanOpenInfo=function(e){var t=this;o.iterateAndEmitChangesIfNeeded(this,e.canOpenInfo,function(e,n){return t.mutateAttachmentInNsIdPath(n,{canOpen:e.is_locally_available})})},t.prototype._onReceiveFileInRootCollectionInfo=function(e){var t=this;o.iterateAndEmitChangesIfNeeded(this,e.fileInRootCollectionInfo,function(e,n){return t.mutateAttachmentInNsIdPath(n,{inRootCollection:e})})},t})(r);t.AttachmentStore=u,t.attachmentStore=new u(s.recentActivityDispatcher)}),define("modules/clean/recent_activity/stores/flux_utils",["require","exports","tslib","external/underscore"],function(e,t,n,i){"use strict";function r(e,t,n){var r=!1;i.each(t,function(e,t){n(e,t)&&(r=!0)}),a(e,r)}function a(e,t){t&&e.__emitChange()}function o(e,t){for(var i in t)if(t[i]!==e[i])return n.__assign({},e,t);return e}Object.defineProperty(t,"__esModule",{value:!0}),t.iterateAndEmitChangesIfNeeded=r,t.emitChangeIfNeeded=a,t.getMutatedOrOriginal=o}),define("modules/clean/recent_activity/stores/recent_activity_store",["require","exports","tslib","external/underscore","modules/clean/recent_activity/recent_activity_constants","modules/clean/flux/flux_store","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/recent_activity_dispatcher","modules/clean/recent_activity/models/recent_item","modules/clean/recent_activity/models/utils","modules/clean/recent_activity/models/utils","modules/clean/recent_activity/stores/flux_utils","modules/clean/recent_activity/stores/attachment_store","modules/core/exception"],function(e,t,n,i,r,a,o,c,s,l,d,u,h,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var p=i.values(r.RECENT_EVENT_FILTER_TYPE),_=r.RECENT_EVENT_FILTER_TYPE.ALL,f=r.RECENT_EVENT_FILTER_TYPE.JUNK,g=(function(e){function t(t,n,i){void 0===i&&(i=[]);var r=e.call(this,t)||this;return r.removeItem=function(e){r.idToItem.hasOwnProperty(e.id)&&(delete r.idToItem[e.id],r.needsToRefreshCache=!0)},r.addItem=function(e){e!==r.idToItem[e.id]&&(r.idToItem[e.id]=e,r.needsToRefreshCache=!0)},r.idToItem={},r.userIdToCursor={},r.userIdToIsLoaded={},r.attachmentStore=n,r.didReceiveRawRecentActivities=!1,r.transactionIdToRestoreData={},i.forEach(r.addItem),r.cache={items:i},r.needsToRefreshCache=!1,r}return n.__extends(t,e),t.prototype.getAll=function(){return this.cache.sortedItems||(this.cache.sortedItems=this.cache.items.slice().sort(l.compareRecentItems))},t.prototype.didReceiveRecentActivities=function(){return this.didReceiveRawRecentActivities},t.prototype.cursorForUser=function(e){return this.userIdToCursor[e]||null},t.prototype.isLoadedForUser=function(e){return this.userIdToIsLoaded.hasOwnProperty(String(e))},t.prototype.getById=function(e){return this.idToItem[e]||null},t.prototype.filterItemsForUser=function(e,t){var n=e+":"+t;return this.cache.userIdFilterPairToSortedItems||(this.cache.userIdFilterPairToSortedItems={}),this.cache.userIdFilterPairToSortedItems.hasOwnProperty(n)||(m.assert(p.indexOf(t)>=0,"filter must be one of "+p),this.cache.userIdFilterPairToSortedItems[n]=this.getAll().filter(function(n){return n.viewingUserId===e&&(t===_&&n.uniqueFilterTypes.indexOf(f)<0||n.uniqueFilterTypes.indexOf(t)>=0)})),this.cache.userIdFilterPairToSortedItems[n]},t.prototype.__onDispatch=function(e){switch(e.type){case o.DELETE_FILES_COMMIT:this.onCommit(e);break;case o.DELETE_FILES_PENDING:this.onDeleteFilesPending(e);break;case o.DELETE_FILES_ROLLBACK:this.onDeleteFilesRollback(e);break;case o.RECEIVE_RAW_RECENT_ACTIVITIES:this.onReceiveRawRecentActivities(e);break;case o.RECEIVE_RAW_RELATED_ACTIVITIES_BY_KEY:this.onReceiveRawRelatedActivitiesByKey(e);break;case o.RAW_RELATED_ACTIVITY_PARSE_ERROR:this.onRawRelatedActivityParseError(e);break;default:return}this.updateCache(!0)},t.prototype.updateCache=function(e){this.needsToRefreshCache&&(this.cache={items:i.values(this.idToItem)},this.needsToRefreshCache=!1,u.emitChangeIfNeeded(this,e))},t.prototype.onCommit=function(e){delete this.transactionIdToRestoreData[e.transactionId]},t.prototype.onReceiveRawRecentActivities=function(e){var t=this;this.didReceiveRawRecentActivities||e.rawRecentActivities.length||(this.didReceiveRawRecentActivities=!0,this.__emitChange()),
this.didReceiveRawRecentActivities=!0;var n=!this.cache.items.length,r={};if(e.rawRecentActivities.forEach(function(e){var a=s.convertRecentActivityToRecentItem(e);if(a)if(n)t.idToItem[a.id]=a;else if(!r[a.id]){r[a.id]=a;var o=t.cache.items.find(function(e){return e.id!==a.id&&e.contextDisplayName===a.contextDisplayName});if(o){var c=i.intersection(o.attachmentIds,a.attachmentIds);c.length>0&&(t.removeItem(o),t.updateCache(!1))}var l=t.getById(a.id);t.updateItem(a,{paths:l&&l.paths||a.paths})}}),this.updateCache(!1),!n){var a={};this.getAll().forEach(function(e){if(e.attachmentIds.length>0){var n=Object.keys(a).length;e.attachmentIds.forEach(function(e){return a[e]=!0}),n===Object.keys(a).length&&t.removeItem(e)}})}this.userIdToIsLoaded[e.userId]=!0,this.userIdToCursor[e.userId]=e.cursor,this.needsToRefreshCache=!0},t.prototype.onReceiveRawRelatedActivitiesByKey=function(e){var t=this;this.waitForAttachmentStoreDispatcher();var n=Object.keys(e.rawRelatedActivitiesByKey||{});this.getRecentItemsByAttachmentIds(n).forEach(function(e){var n=e.id,i=t.getById(n);if(i){var r=i.attachmentIds;if(r&&r.length){var a=t.attachmentStore.getById(r[0]);if(a&&a.isLoaded){var o=a.fqPath||"";r.slice(1).forEach(function(e){var n=t.attachmentStore.getById(e);if(n.isLoaded){var i=n.fqPath||"";i.split("/").length<o.split("/").length&&(o=i)}});var c=o.split("/"),s=c[c.length-2];t.updateItem(i,{paths:d.getPathsByFqPath(o,i.viewingUserId),contextDisplayName:s||i.contextDisplayName})}}}})},t.prototype.onRawRelatedActivityParseError=function(e){this.getRecentItemsByAttachmentIds(i.pluck(e.errors,"activityKey")).forEach(this.removeItem)},t.prototype.onDeleteFilesPending=function(e){this.waitForAttachmentStoreDispatcher();var t=this.deleteAttachments(e.attachmentIds);t&&(this.transactionIdToRestoreData[e.transactionId]=t)},t.prototype.onDeleteFilesRollback=function(e){this.waitForAttachmentStoreDispatcher();var t=this.transactionIdToRestoreData[e.transactionId];m.assert(!!t,"Unable to find data for transaction with id: "+e.transactionId),delete this.transactionIdToRestoreData[e.transactionId],this.rollbackDelete(t)},t.prototype.deleteAttachments=function(e){var t=null;if(e.length){var n=this.getRecentItemsByAttachmentIds([e[0]])[0];if(n){var r=i.difference(n.attachmentIds,e);this.updateItem(n,{attachmentIds:r}),t={deletedAttachmentIds:e,item:n},0===r.length&&this.removeItem(n)}}return t},t.prototype.rollbackDelete=function(e){var t,n=this.getById(e.item.id);n?t=n.attachmentIds:(n=e.item,t=[]),this.updateItem(n,{attachmentIds:i.unique(t.concat(e.deletedAttachmentIds))})},t.prototype.getCachedAttachmentIdToIdToItem=function(){var e=this;return this.cache.attachmentIdToIdToItem||(this.cache.attachmentIdToIdToItem={},this.cache.items.forEach(function(t){return t.attachmentIds.forEach(function(n){e.cache.attachmentIdToIdToItem[n]?e.cache.attachmentIdToIdToItem[n][t.id]=t:e.cache.attachmentIdToIdToItem[n]=(i={},i[t.id]=t,i);var i})})),this.cache.attachmentIdToIdToItem},t.prototype.getRecentItemsByAttachmentIds=function(e){var t=this.getCachedAttachmentIdToIdToItem(),n={};return e.forEach(function(e){t.hasOwnProperty(e)&&i.values(t[e]).forEach(function(e){return n[e.id]=e})}),i.values(n)},t.prototype.waitForAttachmentStoreDispatcher=function(){this.getDispatcher().waitFor([this.attachmentStore.getDispatchToken()])},t.prototype.updateItem=function(e,t){this.addItem(u.getMutatedOrOriginal(e,t))},t})(a);t.RecentActivityStore=g,t.recentActivityStore=new g(c.recentActivityDispatcher,h.attachmentStore)}),define("modules/clean/recent_activity/stores/selection_store",["require","exports","tslib","external/underscore","modules/clean/flux/flux_store","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/recent_activity_dispatcher"],function(e,t,n,i,r,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=(function(e){function t(t,n,i){void 0===n&&(n=null),void 0===i&&(i=[]);var r=e.call(this,t)||this;return r.selectedAttachmentIds=i,r.recentItemId=n,r}return n.__extends(t,e),t.prototype.getByRecentItemId=function(e){return e===this.recentItemId?this.selectedAttachmentIds:[]},t.prototype.__onDispatch=function(e){switch(e.type){case a.SELECT_ATTACHMENTS:this._onReceiveSelectAttachments(e);break;case a.DESELECT_ATTACHMENTS:this._onReceiveDeselectAttachments(e)}},t.prototype._onReceiveSelectAttachments=function(e){this.recentItemId!==e.recentItemId&&(this.recentItemId=e.recentItemId,this.selectedAttachmentIds=[]),this.selectedAttachmentIds=i.unique(this.selectedAttachmentIds.concat(e.attachmentIds)),this.__emitChange()},t.prototype._onReceiveDeselectAttachments=function(e){this.recentItemId!==e.recentItemId&&(this.recentItemId=e.recentItemId,this.selectedAttachmentIds=[]),this.selectedAttachmentIds=this.selectedAttachmentIds.filter(function(t){return e.attachmentIds.indexOf(t)===-1}),this.__emitChange()},t})(r);t.SelectionStore=c,t.selectionStore=new c(o.recentActivityDispatcher)}),define("modules/clean/recent_activity/versions/recent_activity_version_shared",["require","exports","tslib","modules/core/i18n","modules/clean/recent_activity/actions/recent_activity_actions","modules/clean/recent_activity/models/utils","modules/clean/recent_activity/store_utils","modules/clean/recent_activity/stores/recent_activity_store","modules/core/exception"],function(e,t,n,i,r,a,o,c,s){"use strict";function l(e,t){return c.recentActivityStore.filterItemsForUser(e,t)}Object.defineProperty(t,"__esModule",{value:!0});var d=(function(){function e(){}return e.prototype.getRemoveStoreListeners=function(e){return c.recentActivityStore.addListener(e)},e.prototype.loadPage=function(e,t){void 0===t&&(t=!1),o.loadRecentItems(e,{isBackgroundRequest:t})},e.prototype.getLoggingInfo=function(e){return n.__assign({homeLogEventFunction:this.logEvent},e)},e.prototype.shareRecentItem=function(e,t,n){var i=e.viewingUserId;if(1===e.attachmentIds.length||1===t.length)r.shareFile(i,t[0].id,this.getLoggingInfo(n));else{var o=a.extractAttachmentIds(t);r.shareCollection(i,o,this.getLoggingInfo(n))}},e.prototype.previewOrBrowseRecentItem=function(e,t,n,i){if(n.shouldBrowse){var a=t[0].entityUri;a?r.browseFile(a):s.reportStack("Missing entityUri. Cannot browse/preview",{severity:s.SEVERITY.NONCRITICAL,exc_extra:{recent_item:e,attachments:t}})}else this.previewRecentItem(e,t,n,i)},e.prototype.deleteRecentItem=function(e,t,n){r.promptAndDeleteAttachments(e.viewingUserId,a.extractAttachmentIds(t),this.getLoggingInfo(n))},e.prototype.archiveRecentItem=function(e,t){s.reportStack("Archiving is not supported",{severity:s.SEVERITY.NONCRITICAL,exc_extra:{recentItem:e}})},e})();t.RecentActivityVersionShared=d,t.getRecentItemsFromAntenna=l,t.ACTION_LABELS={OPEN:i._("Open"),COMMENT:i._("Comment"),ARCHIVE:i._("Archive"),VERSION:i._("Version history"),SELECT:i._("Select all"),DESELECT:i._("Deselect all")}});
//# sourceMappingURL=pkg-recents-and-home.min.js-vflulsNPz.map